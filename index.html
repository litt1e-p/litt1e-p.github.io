<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>litt1e-p</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="litt1e-p">
<meta property="og:url" content="https://litt1e-p.github.io/index.html">
<meta property="og:site_name" content="litt1e-p">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="litt1e-p">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="litt1e-p" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <section id="main">
  
    <article id="post-Elegant-Swift-Use-autoclosure-to-simplify-swift-syntax" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/07/Elegant-Swift-Use-autoclosure-to-simplify-swift-syntax/">Elegant Swift -- Use @autoclosure to simplify swift syntax</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/03/07/Elegant-Swift-Use-autoclosure-to-simplify-swift-syntax/" class="article-date">
  <time datetime="2018-03-07T10:07:10.000Z" itemprop="datePublished">2018-03-07</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä½¿ç”¨@autoclosureç®€åŒ–è¯­æ³•">ä½¿ç”¨@autoclosureç®€åŒ–è¯­æ³•</h2><p>åœ¨swiftä¸­ï¼Œ@autoclosureå±æ€§å¸¸ç”¨äºclosureé—­åŒ…ä¸­å‚æ•°ä¼ é€’å€¼æ—¶çš„ç®€åŒ–è¡¨è¾¾ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå¯ä»¥åœ¨é—­åŒ…å‚æ•°ä¼ é€’æ—¶ä¸ç”¨å†ä½¿ç”¨èŠ±æ‹¬å·{}ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">foo1</span><span class="params">(<span class="number">_</span> lhs: <span class="params">()</span></span></span> -&gt; <span class="type">Int</span>, <span class="number">_</span> rhs: () -&gt; <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(lhs)</span> &amp; <span class="subst">\(rhs)</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">foo2</span><span class="params">(<span class="number">_</span> lhs: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">String</span>, <span class="number">_</span> rhs: <span class="preprocessor">@autoclosure</span> () -&gt; <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(lhs)</span> &amp; <span class="subst">\(rhs)</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‹¥ä¸ä½¿ç”¨<code>@autoclosure</code>å±æ€§ï¼Œå¦‚foo1, è°ƒç”¨æ—¶ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">foo1</span><span class="params">(&#123;<span class="number">1</span>&#125;, &#123;<span class="string">"true"</span>&#125;)</span></span></span><br></pre></td></tr></table></figure>
<p>å‡å¦‚åŠ å…¥äº†<code>@autoclosure</code>å±æ€§ï¼Œå¦‚foo2, åˆ™ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">foo2</span><span class="params">(<span class="number">1</span>+<span class="number">2</span>, <span class="string">"true"</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ï¼Ÿ</p>
<h4 id="@autoclosureé»‘é­”æ³•">@autoclosureé»‘é­”æ³•</h4><blockquote>
<p><strong>åŠ¨æ€ç±»å‹æŒ‡å®š</strong></p>
</blockquote>
<p>å½“æˆ‘ä»¬ä¸çŸ¥é“æŸäº›å˜é‡çš„ç±»å‹æ—¶ï¼Œå¦‚åœ¨UserDefaultä¸­ã€åœ¨æ•°æ®åº“ä¸­ã€åœ¨Dictionaryä¸­æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåœ¨è§£åŒ…å–å€¼çš„æ—¶å€™èµ‹å€¼ä¸€ä¸ªé»˜è®¤å€¼å¹¶ä¸”æŒ‡å®šç±»å‹ï¼š</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> score = (UserDefaults.standard.<span class="keyword">value</span>(forKey: <span class="string">"SomeKey"</span>) <span class="keyword">as</span>? Int) ?? <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„å†™æ³•ï¼Œä¸ä»…å¯è¯»æ€§éå¸¸å·®ï¼Œè€Œä¸”è¿˜ä¸å¤ªä¼˜é›…ã€‚å¦‚æœåˆ©ç”¨<code>@autoclosure</code>å±æ€§ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UserDefaults</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">value</span><span class="generics">&lt;T&gt;</span><span class="params">(forKey key: String, defaultValue: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> value = <span class="keyword">self</span>.value(forKey: key) <span class="keyword">as</span>? <span class="type">T</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> defaultValue()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">val</span> = <span class="type">UserDefaults</span>.standard.<span class="keyword">value</span>(forKey: <span class="string">"SomeKey"</span>, defaultValue: <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>ç»“æœä¸­çš„valçš„ç±»å‹åˆ™ç”±defaultValueå‚æ•°çš„ç±»å‹å†³å®šã€‚å¯¹æ¯”å¸¸è§„å†™æ³•ï¼Œæ˜¯ä¸æ˜¯ä¼˜é›…å¤šäº†ï¼Ÿ</p>
<h4 id="æ³¨æ„ç‚¹">æ³¨æ„ç‚¹</h4><p><code>@autoclosure</code>é»˜è®¤æ˜¯<code>nonescape</code>çš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨<code>@autoclosure</code>çš„åŸºç¡€ä¸Šåšè¿›ä¸€æ­¥çš„è¯´æ˜ï¼ŒæŒ‡æ˜è¿™ä¸ªé—­åŒ…å‚æ•°æ˜¯å¯é€ƒé€¸çš„ã€‚</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func foo<span class="function"><span class="params">(f: <span class="property">@autoclosure</span>(escaping) () -&gt; ())</span> &#123;</span><br><span class="line">    <span class="title">f</span><span class="params">()</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h5><blockquote>
<p><a href="https://medium.com/@johnsundell/using-autoclosure-when-designing-swift-apis-67fe20a8b2e" target="_blank" rel="external">https://medium.com/@johnsundell/using-autoclosure-when-designing-swift-apis-67fe20a8b2e</a></p>
</blockquote>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-URL" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/18/Elegant-Swift-URL/">Elegant Swift -- URL</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/02/18/Elegant-Swift-URL/" class="article-date">
  <time datetime="2018-02-18T11:29:13.000Z" itemprop="datePublished">2018-02-18</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¼˜é›…çš„Swift_â€“_çƒ¦äººçš„URL">ä¼˜é›…çš„Swift â€“ çƒ¦äººçš„URL</h2><p>åœ¨æ—¥å¸¸codingä¸­ï¼Œå¯¹äºURLä¼ å‚ï¼Œæ—¶å¸¸ä¼šè¯¯ä¼ äº†stringç±»å‹çš„urlï¼Œå¦‚ï¼š</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">"https://www.github.com"</span></span><br><span class="line"><span class="keyword">let</span> task = URLSession.<span class="keyword">shared</span>.dataTask(<span class="keyword">with</span>: url)</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯ç¼–è¯‘å™¨æŠ¥é”™ï¼Œç„¶ååˆæ‚»æ‚»åŠ ä¸Š<code>URL(string: &quot;url address&quot;)</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let url = <span class="string">"https://www.github.com"</span></span><br><span class="line">let task = URLSession<span class="class">.shared</span><span class="class">.dataTask</span>(with: <span class="function"><span class="title">URL</span><span class="params">(string: url)</span></span>)</span><br></pre></td></tr></table></figure>
<p>æœ‰æ²¡æœ‰ä¸€ç§ä¼˜é›…çš„æ–¹å¼ï¼Œè®©æˆ‘ä»¬ç›´æ¥å°±è¾“å…¥Stringç±»å‹çš„ç½‘å€urlï¼Œè‡ªåŠ¨è¯†åˆ«è½¬æ¢æˆä¸ºURLç±»å‹çš„å‚æ•°å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">URL</span>: <span class="title">ExpressibleByStringLiteral</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// By using 'StaticString' we disable string interpolation, for safety</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(stringLiteral value: <span class="type">StaticString</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span> = <span class="type">URL</span>(string: <span class="string">"<span class="subst">\(value)</span>"</span>).require(hint: <span class="string">"Invalid URL string literal: <span class="subst">\(value)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let task = URLSession<span class="class">.shared</span><span class="class">.dataTask</span>(with: <span class="string">"https://www.github.com"</span>)</span><br></pre></td></tr></table></figure>
<p>ä¼˜é›…ä¸€å¥è¯æå®šï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘å¿˜è®°å†™<code>URL(string:)</code>äº†ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„requireä¹Ÿæ˜¯ä¸€ä¸ªextensionæ–¹æ³•ï¼Œä¸ºäº†å¢åŠ å®‰å…¨æ€§åˆ¤æ–­</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¼ºåˆ¶è¦æ±‚è¿™ä¸ª optional ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">/// - hint: ä¸ºç©ºæŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Returns: optional çš„å€¼.</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">require</span><span class="params">(hint hintExpression: @autoclosure<span class="params">()</span></span></span> -&gt; <span class="type">String</span>? = <span class="literal">nil</span>, file: <span class="type">StaticString</span> = #file, line: <span class="type">UInt</span> = #line) -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> unwrapped = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> message = <span class="string">"required value was nil <span class="subst">\(file)</span>, at line <span class="subst">\(line)</span>"</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> hint = hintExpression() &#123;</span><br><span class="line">                message.append(<span class="string">". Debugging hit: <span class="subst">\(hint)</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            #<span class="keyword">if</span> !os(<span class="type">Linux</span>)</span><br><span class="line">            <span class="keyword">let</span> exception = <span class="type">NSException</span>(name: .invalidArgumentException,</span><br><span class="line">                                        reason: message,</span><br><span class="line">                                        userInfo: <span class="literal">nil</span>)</span><br><span class="line">            exception.raise()</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            <span class="built_in">preconditionFailure</span>(message)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> unwrapped</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“">æ€»ç»“</h4><p>è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„æ€è·¯ï¼ŒæŠ›ç –å¼•ç‰ï¼Œå¤§å®¶å¯ä»¥å‘æ•£å¼€æ¥ï¼Œä¸ºå…¶ä»–ç±»å‹æˆ–è€…æ–¹æ³•å†™æ›´å¤šæ›´ä¼˜é›…çš„ä»£ç ã€‚</p>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-UnWrapped-or-Default-Value" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/01/Elegant-Swift-UnWrapped-or-Default-Value/">Elegant Swift -- UnWrapped or Default Value</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/02/01/Elegant-Swift-UnWrapped-or-Default-Value/" class="article-date">
  <time datetime="2018-02-01T14:18:10.000Z" itemprop="datePublished">2018-02-01</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¼˜é›…çš„Swiftâ€“è§£åŒ…">ä¼˜é›…çš„Swiftâ€“è§£åŒ…</h2><p>é€šå¸¸æˆ‘ä»¬åœ¨swiftä¸­å¯¹å¯é€‰å€¼ç±»å‹(optional)è¿›è¡Œè§£åŒ…(unwrapped)æ“ä½œæ—¶ï¼Œ<br>ä¼šè¿›è¡Œä¸€äº›å¸¸è§„çš„åˆ¤æ–­ï¼Œå¦‚ï¼š</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="built_in">String</span>?</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> _ = a &#123;</span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†è¿›è¡Œè§£åŒ…æ“ä½œã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´åŠ ä¼˜é›…çš„æ–¹å¼å‘¢ï¼Ÿ</p>
<ul>
<li>åˆ©ç”¨extensionè¿›è¡Œè§£åŒ…</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">@discardableResult</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">ifSome</span><span class="params">(<span class="number">_</span> closure: <span class="params">(Wrapped)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Optional</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .some(<span class="keyword">let</span> wrapped): closure(wrapped); <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    <span class="keyword">case</span> .<span class="keyword">none</span>: <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@discardableResult</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">ifNone</span><span class="params">(<span class="number">_</span> closure: <span class="params">()</span></span></span> -&gt; ()) -&gt; <span class="type">Optional</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .some: <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">case</span> .<span class="keyword">none</span>: closure(); <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šï¼š <code>ifSome</code>æ–¹æ³•åˆ©ç”¨äº†extensionç»™å¯é€‰å€¼è¿›è¡Œå†…éƒ¨è§£åŒ…æ“ä½œï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ªclosureè¿›è¡Œæ˜¯å¦éœ€è¦è§£åŒ…çš„åˆ¤æ–­ä¹‹åæ‰§è¡Œclosureï¼Œ<code>ifNone</code>äº¦åŒç†ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let <span class="operator">a</span>: String? = <span class="string">"str"</span></span><br><span class="line"><span class="operator">a</span>.ifSome(&#123;</span><br><span class="line"><span class="comment"> //do something</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="operator">a</span>.ifNone(&#123;</span><br><span class="line"><span class="comment"> //do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ©ç”¨extensionèµ‹äºˆé»˜è®¤å€¼</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> `<span class="title">or</span>`<span class="params">(<span class="number">_</span> value: Wrapped)</span></span> -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span> ?? value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šï¼šä¸è§£é‡Šäº†ï¼Œç®€å•ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a: <span class="built_in">String</span>? = nil</span><br><span class="line"><span class="keyword">let</span> v = a.or(<span class="string">"b"</span>)</span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œæœ‰äººå°±ä¼šé—®äº†ï¼Œç›´æ¥ä½¿ç”¨<code>??</code>è¿›è¡Œè§£åŒ…åŠé»˜è®¤å€¼èµ‹å€¼ä¸æ›´ç®€å•å—ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œçœ‹èµ·æ¥æ˜¯å†™æ›´å°‘çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€å•äº†ï¼Œå®é™…ä¸Šä½¿ç”¨extensionçš„è¿™æ ·çš„æ–¹æ³•åœ¨å†™æ³•ä¸Šä¼šå¢åŠ å¯è¯»æ€§ï¼Œå› ä¸ºæœ¬æ¥çš„å¯é€‰ç±»å‹(Optional)è§£åŒ…æ—¶å°±å¸¦äº†ä¸ª<code>?</code>, å¤ªå¤š<code>?</code>å†™åœ¨ä¸€èµ·æ¯”è¯­ä¹‰åŒ–çš„<code>or</code>ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ã€‚ä¸ç®¡å¦‚ä½•ï¼Œè§ä»è§æ™ºäº†ã€‚</p>
<h5 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h5><blockquote>
<p><a href="https://medium.com/swift-snippets/swift-snippet-7-optional-cd9869b8b569" target="_blank" rel="external">https://medium.com/swift-snippets/swift-snippet-7-optional-cd9869b8b569</a></p>
</blockquote>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Range" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/17/Elegant-Swift-Range/">Elegant Swift -- Range</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/17/Elegant-Swift-Range/" class="article-date">
  <time datetime="2018-01-17T12:56:45.000Z" itemprop="datePublished">2018-01-17</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¼˜é›…çš„Swiftâ€“èŒƒå›´åˆ¤æ–­(ï½=æ“ä½œç¬¦)">ä¼˜é›…çš„Swiftâ€“èŒƒå›´åˆ¤æ–­(ï½=æ“ä½œç¬¦)</h2><p>æˆ‘ä»¬å¯¹æ•°ç»„å–å€¼æ˜¯å¦è¶Šç•Œè¿›è¡Œåˆ¤æ–­ï¼Œé€šå¸¸çš„å†™æ³•æ˜¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">item</span><span class="params">(at index: Int, array: Array&lt;Element&gt;)</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">guard</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; array.<span class="built_in">count</span> - <span class="number">1</span> &#123; <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">nil</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> array[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä¼˜é›…ä¸€ç‚¹å†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">item</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> - <span class="number">1</span> &#123; <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">nil</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>[index]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„å†™æ³•å‘¢ï¼Ÿçœ‹çœ‹ä¸‹é¢è¿™æ ·å†™ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">item</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> startIndex..&lt;endIndex ~= index <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>[index]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯æ›´åŠ ä¼˜é›…ç‚¹äº†å‘¢ï¼Ÿ</p>
<p>æ“ä½œç¬¦Operator<code>~=</code>å…¶å®æ˜¯ç”¨äºåŒ¹é…caseæ“ä½œçš„ï¼Œä¸‹é¢ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<ol>
<li>å…ˆå®šä¹‰ä¸€ä¸ªstruct</li>
</ol>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pet</span> </span>&#123;</span><br><span class="line">    let name: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>å†implement<code>~=</code>æ–¹æ³•</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> ~=<span class="params">(pattern: String, value: Pet)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value.name == pattern</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="type">Pet</span>(name: <span class="string">"Poly"</span>)</span><br><span class="line"><span class="keyword">switch</span> p &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"Poly"</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"I am Poly"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"no me"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å½“è°ƒç”¨<code>case</code>æ—¶ï¼Œä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>~=</code>æ–¹æ³•è¿›è¡Œåˆ¤æ–­</strong></p>
<p>æˆ–è€…è¿™æ ·åˆ¤æ–­ä¹Ÿä¼šè°ƒç”¨è‡ªå®šä¹‰çš„<code>~=</code>æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> <span class="string">"Poly"</span> = p &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"It's still me!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å¾—çŸ¥Arrayçš„extensionæ–¹æ³•ä¸­çš„<code>startIndex..&lt;endIndex ~= index</code>åŒæ ·æ˜¯è°ƒç”¨äº†åœ¨å…¶å†…éƒ¨å®ç°çš„<code>~=</code>æ–¹æ³•ã€‚</p>
<h4 id="~=_çš„æ›´å¤šç¤ºä¾‹"><code>~=</code> çš„æ›´å¤šç¤ºä¾‹</h4><ul>
<li>1 æ£€æµ‹å˜é‡næ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…(10~100)</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let n: Int = <span class="number">100</span></span><br><span class="line"><span class="comment">// using "patterns"</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">10.</span>.<span class="number">.100</span> ~= n&#123;</span><br><span class="line">    print(<span class="string">"inside!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>2 æ£€æµ‹httpå“åº”å€¼</li>
</ul>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="built_in">response</span> = <span class="built_in">response</span> as? HTTPURLResponse , <span class="number">200.</span>.<span class="number">.299</span> ~= <span class="built_in">response</span>.statusCode &#123;</span><br><span class="line">    <span class="keyword">let</span> contentLength : Int64 = <span class="built_in">response</span>.expectedContentLength</span><br><span class="line">    completionHandler(contentLength)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    completionHandler(nil)</span><br></pre></td></tr></table></figure>
<h5 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h5><blockquote>
<p><a href="https://stackoverflow.com/questions/38371870/operator-in-swift" target="_blank" rel="external">https://stackoverflow.com/questions/38371870/operator-in-swift</a></p>
</blockquote>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Operator" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/Elegant-Swift-Operator/">Elegant Swift -- Operator</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/14/Elegant-Swift-Operator/" class="article-date">
  <time datetime="2018-01-14T15:54:58.000Z" itemprop="datePublished">2018-01-14</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¼˜é›…çš„Swift_â€“_è‡ªå®šä¹‰æ“ä½œç¬¦(Operator)">ä¼˜é›…çš„Swift â€“ è‡ªå®šä¹‰æ“ä½œç¬¦(Operator)</h2><p>è‡ªä»æœ‰äº†extensionåï¼Œswiftå†™å‡ºçš„ä»£ç å˜å¾—ä¼˜é›…äº†è®¸å¤šã€‚æˆ‘ä»¬å¸¸ä¼šçœ‹åˆ°ä¸€äº›å¼€æºçš„ç¬¬ä¸‰æ–¹åº“ä¼šå‡ºç°ä¸€äº›è¯¡å¼‚çš„ç¬¦å·ã€‚æ¯”å¦‚è‘—åçš„jsonè§£æåº“<a href="https://github.com/hkellaway/Gloss" target="_blank" rel="external">gloss</a>ä¸­çš„<code>~~&gt;</code>ã€<code>&lt;~~</code>ï¼Œè¿˜æœ‰<a href="https://github.com/thoughtbot/Argo" target="_blank" rel="external">Argo</a>ä¸­çš„<code>&lt;^&gt;</code>ã€<code>&lt;*&gt;</code>ã€<code>&lt;|</code>ã€<code>&lt;|?</code>ã€<code>&lt;||</code>ç­‰ç­‰ã€‚</p>
<p>è¿™ç§å«åšæ“ä½œç¬¦(Operator)çš„ä¸œè¥¿å®é™…ä¸Šæ¯”extensionæ›´åŠ åœ°ä¼˜é›…ï¼Œå› ä¸ºä¸ç”¨å†å†™ä¸ªæ–¹æ³•åæ¥è°ƒç”¨ï¼Œç®€å•ä¸€ä¸ªç¬¦å·å³å¯ç¥å¥‡åœ°è¾¾åˆ°è°ƒç”¨çš„ç›®çš„ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªæ“ä½œç¬¦ï¼Œæ¥å®ç°ç®€å•base64åŠ å¯†çš„åŠŸèƒ½ã€‚</p>
<h5 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h5><p>1.è¿ç®—ç¬¦å®šä¹‰</p>
<ul>
<li>prefix è¡¨ç¤ºå®šä¹‰ä¸€ä¸ªå‰ä½æ“ä½œç¬¦ï¼ˆå‰æ˜¯è¾“å…¥ï¼‰</li>
<li>infix è¡¨ç¤ºå®šä¹‰ä¸€ä¸ªä¸­ä½æ“ä½œç¬¦ï¼ˆå‰åéƒ½æ˜¯è¾“å…¥ï¼‰</li>
<li>postfix è¡¨ç¤ºå®šä¹‰ä¸€ä¸ªåä½æ“ä½œç¬¦ï¼ˆåæ˜¯è¾“å…¥ï¼‰</li>
</ul>
<p>2.ç»“åˆå¾‹ associativity (è®¡ç®—é¡ºåº)</p>
<ul>
<li>left ï¼ˆä»å·¦å¾€å³çš„é¡ºåºï¼‰</li>
<li>rightï¼ˆä»å³å¾€å·¦çš„é¡ºåºï¼‰</li>
<li>noneï¼ˆé»˜è®¤å°±ä¸º noneï¼Œä¸ä¼šå†ç»“åˆï¼‰</li>
</ul>
<p>3.ä¼˜å…ˆçº§ Precedence</p>
<ul>
<li>higherThan ä¼˜å…ˆçº§é«˜äº</li>
<li>lowerThan ä¼˜å…ˆçº§ä½äº</li>
</ul>
<p>å¸¸ç”¨çš„Precedenceï¼Œè¯¦è§<a href="https://developer.apple.com/documentation/swift/operator_declarations" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªPrecedenceã€‚</p>
<h5 id="å®æˆ˜">å®æˆ˜</h5><p>ç®€å•ç”¨ä¸€ä¸ªè‡ªå®šä¹‰æ“ä½œç¬¦ï¼Œå®ç°base64åŠ å¯†å’Œè§£å¯†åŠŸèƒ½ã€‚</p>
<ol>
<li><p>å…ˆå®šä¹‰ä¸€ä¸ªä¼˜å…ˆçº§group</p>
 <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">precedencegroup</span> <span class="tag">MyPrecedence</span> &#123;</span><br><span class="line"> <span class="attribute">associativity</span>: none</span><br><span class="line"> <span class="attribute">higherThan</span>: AdditionPrecedence</span><br><span class="line"> <span class="attribute">lowerThan</span>: MultiplicationPrecedence</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> è¿™é‡Œassociativityå› ä¸ºæ²¡æœ‰å‰åè¾“å…¥é¡ºåºå°±ç›´æ¥ä½¿ç”¨é»˜è®¤çš„noneï¼ŒPrecedenceæˆ‘ä»¬æ¯”åŠ æ³•(AdditionPrecedence)é«˜ï¼Œæ¯”ä¹˜æ³•(MultiplicationPrecedence)ä½å°±è¡Œäº†ï¼Œå› ä¸ºå¦‚æœæ˜¯æ•°å­—é‡åˆ°è¿ç®—éœ€è¦è¿›è¡Œä¼˜å…ˆçº§çš„åˆ¤æ–­ã€‚</p>
</li>
<li><p>å®šä¹‰ä¸€ä¸ªæ“ä½œç¬¦</p>
 <figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="infix"><span class="keyword">infix</span> operator *=* : MyPrecedence</span></span><br></pre></td></tr></table></figure>
<p> è¿™é‡Œå®šä¹‰ä¸€ä¸ªä¸­ä½æ“ä½œç¬¦</p>
</li>
<li><p>å®ç°åŠŸèƒ½çš„æ–¹æ³•</p>
 <figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> enum CryptoType &#123;</span><br><span class="line">    <span class="keyword">case</span> encrypt, decrypt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func *=* (input: <span class="built_in">String</span>, <span class="keyword">type</span>: CryptoType) <span class="subst">-&gt; </span><span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">type</span> == <span class="built_in">.</span>encrypt &#123;</span><br><span class="line">        guard <span class="keyword">let</span> utf8Data = input<span class="built_in">.</span><span class="built_in">data</span>(using: <span class="built_in">String</span><span class="built_in">.</span>Encoding<span class="built_in">.</span>utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">String</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> utf8Data<span class="built_in">.</span>base64EncodedString()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        guard <span class="keyword">let</span> utf8Data = <span class="built_in">Data</span>(base64Encoded: input) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">String</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(<span class="built_in">data</span>: utf8Data, encoding: <span class="built_in">.</span>utf8) ?? <span class="built_in">String</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> è¿™é‡Œå£°æ˜ä¸€ä¸ªæšä¸¾ï¼ŒåŠ¨æ€åˆ‡æ¢åŠ å¯†æˆ–è€…è§£å¯†æ“ä½œã€‚</p>
</li>
<li><p>æµ‹è¯•</p>
 <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let <span class="operator">a</span> = <span class="string">"1234567890"</span> *=* .<span class="built_in">encrypt</span></span><br><span class="line">print(<span class="operator">a</span>)<span class="comment"> // MTIzNDU2Nzg5MA==</span></span><br><span class="line">let b = <span class="operator">a</span> *=* .<span class="built_in">decrypt</span></span><br><span class="line">print(b)<span class="comment"> // 1234567890</span></span><br></pre></td></tr></table></figure>
<p> å¤§åŠŸå‘Šæˆã€‚æ’’èŠ±ğŸ‰ğŸ‰ğŸ‰</p>
</li>
</ol>
<h5 id="æ€»ç»“">æ€»ç»“</h5><p>ä½¿ç”¨è‡ªå®šä¹‰æ“ä½œç¬¦ï¼Œå¯ä»¥å¤§å¤§æé«˜ä»£ç ä¼˜(zhuang)é›…(bi)æ€§ï¼Œç›¸å¯¹äºextensionæ›´åŠ ç®€æ´æ˜äº†ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè‡ªå®šä¹‰æ“ä½œç¬¦çš„ä½œç”¨åŸŸæ˜¯å…¨å±€çš„ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€äº›é£é™©ï¼Œæ…é‡ä½¿ç”¨ã€‚</p>
<h5 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h5><blockquote>
<p><a href="https://developer.apple.com/documentation/swift/operator_declarations#topic-content" target="_blank" rel="external">https://developer.apple.com/documentation/swift/operator_declarations#topic-content</a></p>
<p><a href="https://stackoverflow.com/questions/45134496/understanding-precedence-groups-assignment-in-swift-3-1" target="_blank" rel="external">https://stackoverflow.com/questions/45134496/understanding-precedence-groups-assignment-in-swift-3-1</a>;</p>
<p><a href="https://github.com/NSCookies/articles/blob/master/publish/%E8%A3%85%E4%B8%AA%E9%80%BC%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6.md" target="_blank" rel="external">https://github.com/NSCookies/articles/blob/master/publish/%E8%A3%85%E4%B8%AA%E9%80%BC%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6.md</a></p>
</blockquote>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Generic-typealias-in-closure" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/09/Elegant-Swift-Generic-typealias-in-closure/">Elegant Swift -- Generic typealias in closure</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/09/Elegant-Swift-Generic-typealias-in-closure/" class="article-date">
  <time datetime="2018-01-09T12:33:39.000Z" itemprop="datePublished">2018-01-09</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¼˜é›…çš„Swift_â€“_é—­åŒ…ä¸­çš„èŒƒå‹">ä¼˜é›…çš„Swift â€“ é—­åŒ…ä¸­çš„èŒƒå‹</h2><p>ä»swift 3å¼€å§‹æœ‰äº†èŒƒå‹(Generic type), èŒƒå‹é™¤äº†å¸¸ç”¨åœ¨æ–¹æ³•é‡Œä½œå‚æ•°çš„å£°æ˜ä¹‹å¤–ï¼Œå…¶å®è¿˜å¯ä»¥ä½¿ç”¨äºé—­åŒ…(Closure)å›è°ƒä¸­ï¼Œæ®æ­¤å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹åœ¨closureä¸­ã€‚</p>
<h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4><p>æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªç®€å•çš„closure:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">typealias Closure&lt;T&gt; = <span class="function"><span class="params">(T)</span> -&gt;</span> Void</span><br><span class="line"><span class="regexp">//</span>è¿”å›å€¼ä¸ºç©º</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>1 ä½¿ç”¨Boolç±»å‹</li>
</ul>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> boolClosure: Closure&lt;<span class="built_in">Bool</span>&gt; = &#123; boolValue <span class="keyword">in</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">boolClosure(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>2 ä½¿ç”¨Stringç±»å‹</li>
</ul>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> strClosure: Closure&lt;<span class="built_in">String</span>&gt; = &#123; strValue <span class="keyword">in</span></span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">&#125;</span><br><span class="line">strClosure(<span class="string">"I am string"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>3 å…¶ä»–ç±»å‹åŒç†</li>
</ul>
<h4 id="æ›´å¤šClosureç¤ºä¾‹">æ›´å¤šClosureç¤ºä¾‹</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typealias Closure&lt;T, U&gt; = <span class="function"><span class="params">(T)</span> -&gt;</span> (U)</span><br><span class="line"></span><br><span class="line">typealias Closure&lt;T&gt; = <span class="function"><span class="params">(T)</span> -&gt;</span> Void</span><br><span class="line"></span><br><span class="line">typealias Closure&lt;T&gt; = <span class="function"><span class="params">()</span> -&gt;</span> T</span><br><span class="line"></span><br><span class="line">typealias Closure = <span class="function"><span class="params">()</span> -&gt;</span> Void</span><br></pre></td></tr></table></figure>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Use-ES7-async-await-in-Wechat-app" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/07/Use-ES7-async-await-in-Wechat-app/">Use ES7 async&amp;await in Wechat app</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/07/Use-ES7-async-await-in-Wechat-app/" class="article-date">
  <time datetime="2018-01-07T11:06:45.000Z" itemprop="datePublished">2018-01-07</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨_ES7_async&amp;await">åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨ ES7 async&amp;await</h2><p>å¾®ä¿¡å°ç¨‹åºè™½ç„¶å·²ç»æ”¯æŒPromissï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†è‡­åæ˜­è‘—çš„callback hellï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            resolve(&#123;data: <span class="string">"Hello,World"</span>&#125;)</span><br><span class="line">        &#125;, <span class="number">5000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä»ä¸å¤Ÿè§£è€¦ä¸å¤Ÿä¼˜é›…ï¼Œè‹¥æ˜¯æ”¯æŒES7çš„asyncå’Œawaitå°±å¥½äº†ï¼Œå¯æƒœå¾®ä¿¡MINA IDEè¿˜ä¸æ”¯æŒè¿™ä¸ªç‰¹æ€§ï¼Œåªèƒ½è‡ªå·±åŠ¨æ‰‹å®ç°äº†ã€‚</p>
<h4 id="åŸç†">åŸç†</h4><p>é¦–å…ˆï¼Œasync/awaitä¹Ÿæ˜¯å’ŒPromiseé…åˆä½¿ç”¨çš„ã€‚å…·ä½“è¯­æ³•ä¸ä¸€ä¸€èµ˜è¿°ï¼Œè¯¦è§<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="external">ES7 Async Await</a></p>
<p>è¿™é‡Œä¸¾ä¸ªç®€å•çš„ä½¿ç”¨ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wxLogin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        wx.login(&#123;</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (r.code) &#123;</span><br><span class="line">                    resolve(r)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(<span class="string">'è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€å¤±è´¥ï¼'</span> + r.errMsg)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: <span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                reject(<span class="string">'è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€å¤±è´¥'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">tryLogin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rs = <span class="keyword">await</span> wxLogin().catch(e =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.info(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">"logined!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tryLogin()</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯ä¼˜é›…å¤šäº†ã€‚è·Ÿcallback hell say byebye.</p>
<h4 id="é…ç½®">é…ç½®</h4><p>é‚£ä¹ˆåˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿå¾®ä¿¡MINAè‡ªå¸¦äº†Babelè½¬æ¢å·¥å…·ï¼Œä½†ä¸å¤Ÿå¼ºå¤§ï¼Œè¿™é‡Œæˆ‘ä»¬è‡ªå·±æ¥é…ç½®ä¸€ä¸ªBabelæ¥è½¬æ¢ç¼–è¯‘æˆ‘ä»¬çš„ä»£ç ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆæŠŠMINAé‡Œçš„<code>å¼€å¯ES6è½¬ES5</code>å…³é—­ï¼Œæˆ‘ä»¬ç”¨è‡ªå·±çš„Babelã€‚</p>
<p><img src="http://ww4.sinaimg.cn/large/006tKfTcgy1fp32ylaplyj311c0ak75l.jpg" alt=""></p>
<p>ç„¶åç”¨Gulpæ¥å†™æˆ‘çš„è„šæœ¬ï¼Œä»Gulpä¸­è°ƒç”¨Babelæ¥ç¼–è¯‘æˆ‘çš„ä»£ç ã€‚zåœ¨è°ƒç”¨Babelæ—¶ï¼Œéœ€è¦ç»™æˆ‘ä»¬çš„Babelé…ç½®æ’ä»¶ä»¥æ”¯æŒasync/awaitï¼Œæ¯”å¦‚async-to-generatorï¼Œasync-generator-functionsç­‰æ’ä»¶ã€‚</p>
<ol>
<li><p>Babelçš„é…ç½®</p>
<p> ç¼–è¾‘Babelçš„é…ç½®æ–‡ä»¶ï¼š.babelrcï¼Œè¿™é‡Œç›´æ¥ç”¨<code>latest</code>ï¼Œä¾¿æ”¯æŒES7ã€‚</p>
 <figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//.<span class="atom">babelrc</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"presets"</span>: [ <span class="string">"latest"</span> ],  </span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Glupçš„é…ç½®</p>
<p> æŠŠæˆ‘ä»¬å°ç¨‹åºé¡¹ç›®ä¸‹æ‰€æœ‰çš„jsæ–‡ä»¶éƒ½é€šè¿‡Babelç¼–è¯‘ï¼š</p>
 <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">gulp.<span class="keyword">task</span>(<span class="string">'scripts'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([<span class="string">'./src/**/*.js'</span>])</span><br><span class="line">        .pipe(babel())</span><br><span class="line">        .pipe(gulpAddRequireRuntime())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function gulpAddRequireRuntime() &#123;</span><br><span class="line">    <span class="keyword">return</span> through.obj(function(<span class="keyword">file</span>, enc, cb) &#123;</span><br><span class="line">        var prefixText = ``;</span><br><span class="line">        var rel = path.relative(path.dirname(<span class="keyword">file</span>.path), path.<span class="keyword">join</span>(<span class="keyword">file</span>.base, <span class="string">'lib/runtime.js'</span>));</span><br><span class="line">        rel = rel.replace(<span class="regexp">/\\/g</span>, <span class="string">'/'</span>);</span><br><span class="line">        <span class="keyword">if</span> (rel === <span class="string">'runtime.js'</span>) &#123;</span><br><span class="line">            prefixText = <span class="keyword">new</span> Buffer(prefixText);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefixText = `var regeneratorRuntime = require(<span class="string">"$&#123;rel&#125;"</span>);`;</span><br><span class="line">            prefixText = <span class="keyword">new</span> Buffer(prefixText);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">file</span>.isNull()) &#123;</span><br><span class="line">            cb(<span class="keyword">null</span>, <span class="keyword">file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">file</span>.isBuffer()) &#123;</span><br><span class="line">            <span class="keyword">file</span>.contents = Buffer.concat([prefixText, <span class="keyword">file</span>.contents]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">file</span>.isStream()) &#123;</span><br><span class="line">            <span class="keyword">file</span>.contents = <span class="keyword">file</span>.contents.pipe(prefixStream(prefixText));</span><br><span class="line">        &#125;</span><br><span class="line">        cb(<span class="keyword">null</span>, <span class="keyword">file</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="ä½¿ç”¨">ä½¿ç”¨</h4><ol>
<li>é¡¹ç›®ç›®å½•ç»“æ„</li>
</ol>
<p><img src="http://ww2.sinaimg.cn/large/006tKfTcgy1fp3384dryfj30mu0e675n.jpg" alt=""></p>
<p>å¦‚å›¾ï¼Œè¿™é‡Œdistç›®å½•æ­£æ˜¯Gulpç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œåœ¨å¾®ä¿¡MINAä¸­ç›´æ¥ç”¨è¿™ä¸ªç›®å½•å³å¯ï¼Œè€Œsrcç›®å½•åˆ™ä¸ºæˆ‘ä»¬æ„‰å¿«ç¼–å†™ES7çš„async&amp;awaitçš„ç›®å½•å•¦ã€‚</p>
<ol>
<li>ä¾èµ–åº“</li>
</ol>
<p>ç»è¿‡Babelè½¬è¯‘åçš„ä»£ç æ˜¯é€šè¿‡ç±»ä¼¼coåº“çš„æ–¹å¼æ¥å®ç°çš„ï¼Œå³éœ€è¦ä½¿ç”¨åˆ°generatorï¼Œæ‰€ä»¥ï¼Œå’Œæˆ‘ä»¬ä½¿ç”¨coçš„æ—¶å€™ä¸€æ ·ï¼Œéœ€è¦ä¾èµ–ä¸€ä¸ªregeneratorRuntimeï¼Œæ‰èƒ½æ”¯æŒgeneratorç‰¹æ€§ã€‚æˆ‘ä»¬è¿™ä½¿ç”¨Facebookå¼€æºçš„<a href="https://github.com/facebook/regenerator/" target="_blank" rel="external">regenerator</a>ã€‚</p>
<p>å®‰è£…regenerator</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> regenerator</span></span><br></pre></td></tr></table></figure>
<ol>
<li>å¼•å…¥</li>
</ol>
<p>æŠŠåˆšæ‰npmå®‰è£…çš„regeneratorä¸‹çš„<code>rumtime.js</code>å¤åˆ¶åˆ°æˆ‘ä»¬çš„src/libä¸‹ï¼Œç„¶ååœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹å¼•å…¥å³å¯æ„‰å¿«åˆä¼˜é›…åœ°å†™æˆ‘ä»¬çš„async/awaitä»£ç å•¦ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const RUNTIME = <span class="function"><span class="title">require</span><span class="params">(<span class="string">"/lib/runtime"</span>)</span></span></span><br></pre></td></tr></table></figure>
<h5 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h5><blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function</a><br><a href="https://www.jianshu.com/p/270f129e5af3" target="_blank" rel="external">https://www.jianshu.com/p/270f129e5af3</a></p>
</blockquote>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Build-a-notification-center-for-wechat-app" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/Build-a-notification-center-for-wechat-app/">Build a notification center for wechat app</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/12/30/Build-a-notification-center-for-wechat-app/" class="article-date">
  <time datetime="2017-12-30T02:30:15.000Z" itemprop="datePublished">2017-12-30</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ä¸ºå¾®ä¿¡å°ç¨‹åºå»ºç«‹é€šçŸ¥ä¸­å¿ƒ">ä¸ºå¾®ä¿¡å°ç¨‹åºå»ºç«‹é€šçŸ¥ä¸­å¿ƒ</h2><p>å¾®ä¿¡å°ç¨‹åºç›®å‰ä¸ºæ­¢ï¼Œé¡µé¢ä¼ å€¼çš„æ–¹å¼ä¸»è¦æœ‰ï¼š</p>
<ul>
<li>globalData å…¨å±€å…±äº«å˜é‡</li>
<li>wx.navigateToç­‰é¡µé¢ä¹‹é—´è·³è½¬çš„urlä¼ å€¼ï¼Œåœ¨ç›®æ ‡é¡µ<code>onLoad</code>ä¸­è·å–</li>
<li>wx.setStorageç¼“å­˜å˜é‡</li>
<li>å…¶ä»–ï¼Ÿ(æ¬¢è¿è¡¥å……)</li>
</ul>
<p>åšè¿‡appï¼Œç‰¹åˆ«æ˜¯iOS appçš„åŒå­¦è‚¯å®šçŸ¥é“åŸç”Ÿappé™¤äº†ä¸Šè¿°çš„æ–¹å¼è¿˜æœ‰ä¼—å¤šçš„ä¼ å€¼ç”šè‡³åå‘ä¼ å€¼æ–¹å¼ï¼Œå¦‚blockï¼Œdelegateä¼ å€¼ï¼Œkvoç­‰ï¼Œå…¶ä¸­æœ€å°‘ä¸äº†çš„æ˜¯ä¸€å¯¹å¤šçš„<code>NotificationCenter/NSNotificationCenter</code>ï¼ŒåšWeChat appæ—¶æ€ä¹ˆå¯ä»¥æ²¡æœ‰é€šçŸ¥ä¸­å¿ƒå‘¢ï¼ŒGitHubä¸Šä¹Ÿæœ‰ä¸€ä½<br>å›½å†…çš„ç¨‹åºå‘˜å†™ä¸€ä¸ªç±»ä¼¼é€šçŸ¥ä¸­å¿ƒçš„jsåº“å«<a href="https://github.com/binnng/broadcast.js" target="_blank" rel="external">broadcast.js</a>ï¼ŒåŸç†ä¹Ÿæ˜¯å¤§è‡´ç›¸åŒï¼Œä»æ³¨å†Œé€šçŸ¥åˆ°é€šçŸ¥ä¸­å¿ƒå‘é€é€šçŸ¥ã€æ”¶åˆ°é€šçŸ¥ï¼Œæºç æ¯”è¾ƒç®€å•ï¼Œåªæœ‰30è¡Œå·¦å³ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> WIN, broadcast;</span><br><span class="line"></span><br><span class="line">WIN = <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">broadcast = &#123;</span><br><span class="line">  on: <span class="function"><span class="keyword">function</span>(<span class="params">name, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> eventData;</span><br><span class="line">    eventData = broadcast.data;</span><br><span class="line">    <span class="keyword">if</span> (eventData.hasOwnProperty(name)) &#123;</span><br><span class="line">      eventData[name].push(fn);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      eventData[name] = [fn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fire: <span class="function"><span class="keyword">function</span>(<span class="params">name, data, thisArg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fn, fnList, i, len;</span><br><span class="line">    thisArg = thisArg || WIN;</span><br><span class="line">    fnList = broadcast.data[name];</span><br><span class="line">    <span class="keyword">if</span> (!fnList.length) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Cannot find broadcast event "</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, len = fnList.length; i &lt; len; i++) &#123;</span><br><span class="line">      fn = fnList[i];</span><br><span class="line">      fn.apply(thisArg, [data, name]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = broadcast;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  WIN.broadcast = broadcast;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤§ä½“ä¸Šæ€è·¯æ˜¯æ­£ç¡®çš„ï¼Œä½†å­˜åœ¨bugï¼Œåœ¨åˆ¤æ–­å¾…é€šçŸ¥çš„äº‹ä»¶æ•°ç»„fnListæ—¶ï¼Œæºç ç›´æ¥åˆ¤æ–­<code>if (!fnList.length)</code>å°±throw errorï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ä¼šcrashï¼Œå› ä¸ºå¯èƒ½æ‰¾ä¸åˆ°å¯¹åº”äº‹ä»¶çš„åå­—ï¼Œä¹Ÿå°±æ˜¯è¯´å‘é€é€šçŸ¥æ—¶å¦‚æœå‘é€ä¸€ä¸ªæœªæ³¨å†Œçš„é€šçŸ¥çš„è¯ï¼ŒfnListéƒ½è¿˜æ˜¯nullæˆ–è€…undefinedçš„ã€‚</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨è°ƒç”¨å‘é€é€šçŸ¥å‰ï¼Œå¿…é¡»å…ˆæ³¨å†Œè¯¥é€šçŸ¥</span></span><br><span class="line">broadcast.reg(config.kAppTestNotificationKey, <span class="function"><span class="keyword">function</span> <span class="params">(cb)</span> </span>&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™å…¶å®ç›¸å½“å°´å°¬ï¼Œæˆ‘å†³å®šæŠŠå®ƒä¿®æ”¹ä¸€ä¸‹ï¼Œé¡ºä¾¿æŠŠæ–¹æ³•åä¹Ÿä¸€èµ·ä¿®æ”¹ä¸€ä¸‹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> WIN, notificationCenter;</span><br><span class="line">WIN = <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">notificationCenter = &#123;</span><br><span class="line">    addObserver: <span class="function"><span class="keyword">function</span>(<span class="params">name, fn</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> eventData;</span><br><span class="line">        eventData = notificationCenter.data;</span><br><span class="line">        <span class="keyword">if</span> (eventData.hasOwnProperty(name)) &#123;</span><br><span class="line">            eventData[name].push(fn);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            eventData[name] = [fn];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    post: <span class="function"><span class="keyword">function</span>(<span class="params">name, data, thisArg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> fn, fnList, i, len;</span><br><span class="line">        thisArg = thisArg || WIN;</span><br><span class="line">        fnList = notificationCenter.data[name];</span><br><span class="line">        <span class="keyword">if</span> (!fnList || !fnList.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Cannot find notificationCenter event "</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>, len = fnList.length; i &lt; len; i++) &#123;</span><br><span class="line">            fn = fnList[i];</span><br><span class="line">            fn.apply(thisArg, [data, name]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    data: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = notificationCenter;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    WIN.notificationCenter = notificationCenter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å‘é€ä¸€ä¸ªæœªæ³¨å†Œçš„é€šçŸ¥æ—¶ä¹Ÿä¸ä¼šthrow erroräº†ï¼Œå¯æ˜¯ï¼Œè¿™ä»£ç ä»ç„¶è¿˜æœ‰bugï¼šè¿™ä¸ªnotificationCenterè‡ªèº«çš„äº‹ä»¶å¯¹è±¡<code>data</code>ä¸­å‚¨å­˜ç€æ‰€æœ‰äº‹ä»¶ï¼Œå…¶å®æ•°æ®ç»“æ„ä¸ºï¼š</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"noti1"</span>: [<span class="literal">k1</span>, <span class="literal">k2</span>, ...],</span><br><span class="line">    <span class="string">"noti2"</span>: [<span class="literal">k1</span>, <span class="literal">k2</span>, ...],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¹¶æ²¡æœ‰æä¾›removeObserverç§»é™¤äº‹ä»¶é€šçŸ¥çš„æ–¹æ³•ï¼Œå…¶é€ æˆå¯¹è±¡å†…éƒ¨æ•°ç»„çš„æ— é™å¢åŠ ï¼Œåœ¨æ¯ä¸€æ¬¡å‘é€é€šçŸ¥æ—¶éå†æ—¶é—´ä¼šæ— é™å¢åŠ ï¼Œæ—¶é—´å¤æ‚åº¦O(n)ä¼šéšç€é€šçŸ¥å¯¹è±¡åŠå…¶å†…éƒ¨äº‹ä»¶æ•°ç»„æ•°é‡å¢åŠ è€Œå¢åŠ ã€‚ä¸ºæ­¤åº”è¯¥å†ä¿®æ”¹ä¸€ä¸‹ï¼Œå¢åŠ ä¸€ä¸ªç§»é™¤äº‹ä»¶é€šçŸ¥çš„æ–¹æ³•ï¼š</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">removeObserver: <span class="function"><span class="keyword">function</span><span class="params">(name, fn)</span> &#123;</span></span><br><span class="line">    var eventData, fnList, <span class="built_in">i</span>, len;</span><br><span class="line">    eventData = notificationCenter.data;</span><br><span class="line">    fnList = notificationCenter.data<span class="matrix">[name]</span>;</span><br><span class="line">    <span class="keyword">if</span> (!fnList || !fnList.<span class="built_in">length</span>) <span class="cell">&#123;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>, len = fnList.<span class="built_in">length</span>; <span class="built_in">i</span> &lt; len; <span class="built_in">i</span>++) <span class="cell">&#123;</span><br><span class="line">        if (fnList[i] == fn) &#123;</span><br><span class="line">            fnList.splice(i, <span class="number">1</span>)</span><br><span class="line">        &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¥½äº†ï¼Œæœ‰<code>addObserver</code>ã€<code>post</code>ã€<code>removeObserver</code>æ–¹æ³•äº†ï¼Œå¤§ä½“ä¸Šæ»¡è¶³äº†æˆ‘ä»¬çš„ä½¿ç”¨è¦æ±‚ï¼Œæ˜¯å¦å·²ç»å®Œç¾äº†å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸å¦¨æƒ³æƒ³çœ‹ï¼Œè¿™ä¸ªé€šçŸ¥ä¸­å¿ƒåº“ï¼Œåœ¨æ¯ä¸€ä¸ªéœ€è¦ä½¿ç”¨çš„pageé‡Œéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡å¼•å…¥æ“ä½œï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">var</span> notificationCenter = <span class="function"><span class="title">require</span><span class="params">(<span class="string">"./lib/notificationCenter"</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>æœ‰äº›äººå°±ä¼šç–‘è™‘äº†ï¼šè¿™æ¯requireä¸€æ¬¡ï¼Œæ˜¯ä¸æ˜¯éƒ½newäº†ä¸€æ¬¡è¿™ä¸ªnotificationCenterï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œæ„å‘³ç€è¿™ä¸ªnotificationCenterå¹¶ä¸æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œç„¶åä¸åŒåœ°æ–¹requireç”Ÿæˆä¸åŒçš„å¯¹è±¡ï¼Œç”šè‡³è¿˜æœ‰çº¿ç¨‹äº‰å¤ºçš„é—®é¢˜â€¦â€¦</p>
<p>äº‹å®çœŸçš„å¦‚æ­¤å—ï¼Ÿå…¶å®åœ¨node.jså®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè¯´æ˜äº†requireæ˜¯å¼•å…¥ä¸€ä¸ªå•ä¾‹</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Every call <span class="built_in">to</span> <span class="built_in">require</span>(<span class="string">'foo'</span>) will <span class="built_in">get</span> exactly <span class="operator">the</span> same object returned, <span class="keyword">if</span> <span class="keyword">it</span> would <span class="built_in">resolve</span> <span class="built_in">to</span> <span class="operator">the</span> same <span class="built_in">file</span>.</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ª<a href="https://medium.com/@lazlojuly/are-node-js-modules-singletons-764ae97519af" target="_blank" rel="external">medium</a>ä¾‹å­ï¼š</p>
<p>å®šä¹‰ä¸€ä¸ªç±»</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> counter.js</span><br><span class="line"></span><br><span class="line">let value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attribute">increment</span>: <span class="function"><span class="params">()</span> =&gt;</span> value++,</span><br><span class="line">  <span class="attribute">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> value,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†requireæµ‹è¯•ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-singleton.js</span></span><br><span class="line"></span><br><span class="line">const counter1 = <span class="function"><span class="title">require</span><span class="params">(â€˜./counter.jsâ€™)</span></span></span><br><span class="line">const counter2 = <span class="function"><span class="title">require</span><span class="params">(â€˜./counter.jsâ€™)</span></span></span><br><span class="line"></span><br><span class="line">counter1.<span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line">counter1.<span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line">counter2.<span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(counter1.get()</span></span>) <span class="comment">// prints 3</span></span><br><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(counter2.get()</span></span>) <span class="comment">// also prints 3</span></span><br></pre></td></tr></table></figure>
<p>è¯æ˜äº†requireæ˜¯å•æ¬¡å¼•å…¥ï¼Œæœ¬è´¨ä¸Šè·Ÿå•ä¾‹ä¸€è‡´ã€‚æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªnotificationCenteréå…¨å±€å•ä¾‹çš„ç–‘è™‘ã€‚è‡³æ­¤ï¼Œè¿™ä¸ªé€šçŸ¥ä¸­å¿ƒä¹Ÿå·®ä¸å¤šå®Œæˆäº†ã€‚</p>
<h5 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h5><blockquote>
<p><a href="http://imweb.io/topic/582293894067ce9726778be9" target="_blank" rel="external">http://imweb.io/topic/582293894067ce9726778be9</a><br><a href="https://github.com/binnng/broadcast.js/blob/master/broadcast.js" target="_blank" rel="external">https://github.com/binnng/broadcast.js/blob/master/broadcast.js</a><br><a href="https://medium.com/@lazlojuly/are-node-js-modules-singletons-764ae97519af" target="_blank" rel="external">https://medium.com/@lazlojuly/are-node-js-modules-singletons-764ae97519af</a></p>
</blockquote>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Use git hooks to deploy automatically" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/07/Use git hooks to deploy automatically/">Use git hooks to deploy automatically</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/09/07/Use git hooks to deploy automatically/" class="article-date">
  <time datetime="2017-09-07T14:55:47.000Z" itemprop="datePublished">2017-09-07</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="git_hooks_å®ç°è‡ªåŠ¨éƒ¨ç½²">git hooks å®ç°è‡ªåŠ¨éƒ¨ç½²</h4><p>å½“æˆ‘ä»¬åœ¨æœ¬åœ°æ‰§è¡Œpushå‘½ä»¤åˆ°gitæœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨è§¦å‘post-receiveé’©å­ã€‚</p>
<p>å‡å¦‚æœ‰ä¸€ä¸ªgitæœåŠ¡å™¨ä»“åº“ç›®å½• ä¾‹å¦‚: /home/git/test.git<br>å’Œä¸€ä¸ªwebæœåŠ¡å™¨ç›®å½•ï¼Œä¾‹å¦‚: /home/wwwroot/default/testRoot</p>
<p>å…ˆåœ¨webç›®å½•é‡Œcloneä¸€ä»½ä»“åº“<br>cd /home/wwwroot/default/testRoot<br>git clone /home/git/test.git</p>
<p>ç„¶åä½¿ç”¨æœåŠ¡ç«¯gité’©å­ post-receiveï¼Œå®ƒä½äº/home/git/test.git/hooks<br>cd /home/git/test.git/hooks/<br>è¿™é‡Œæœ‰post-receive.sample<br>cp post-receive.sample post-receive<br>vi post-receive<br>å†™å…¥å¦‚ä¸‹ä»£ç :</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">unset GIT_DIR </span><br><span class="line">echo <span class="string">'copying to web deploy directory...'</span></span><br><span class="line">CurrentPath=`pwd`</span><br><span class="line">echo <span class="variable">$CurrentPath</span></span><br><span class="line">DeployPath=<span class="string">"/home/wwwroot/default/testRoot"</span></span><br><span class="line">cd <span class="variable">$DeployPath</span> || exit</span><br><span class="line">git pull origin master</span><br><span class="line">echo <span class="string">"update will be completed soon"</span></span><br><span class="line">cd <span class="variable">$CurrentPath</span></span><br><span class="line">exit <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><code>å¦‚æœä¸åŠ  unset GIT_DIR #è¿˜åŸç¯å¢ƒå˜é‡ å°±ä¼šæŠ¥å‡º remote: fatal: not git respository:â€™.â€™ é”™è¯¯</code><br>ä¿å­˜åèµ‹äºˆå¯æ‰§è¡Œæƒé™<br>chmod +x /home/git/test.git/hooks/post-receive</p>
<p>ä¿®æ”¹webæœåŠ¡å™¨æ ¹ç›®å½•çš„æƒé™<br>å› ä¸ºæ‰§è¡Œæ‹‰å–çš„æ—¶å€™æ˜¯gitç”¨æˆ·æ‰€ä»¥è¦æŠŠwebæœåŠ¡å™¨æ ¹ç›®å½•(/home/wwwroot/default/testRoot) çš„æƒé™è®¾å®šä¸ºgitç”¨æˆ·</p>
<p>chown -R git:git /home/wwwroot/default/testRoot</p>
<p>å‚è€ƒç½‘å€ï¼š<br><a href="http://www.jianshu.com/p/f9312b51e011" target="_blank" rel="external">git hooks å®ç°è‡ªåŠ¨éƒ¨ç½²</a><br><a href="http://robin-front.github.io/2016/08/11/%E7%94%A8Git-Hooks%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2-%E8%AE%A9%E6%8F%90%E4%BA%A4%E5%8F%91%E5%B8%83%E8%87%AA%E5%8A%A8%E5%8C%96/" target="_blank" rel="external">ç”¨Git-Hooksè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²,è®©æäº¤å‘å¸ƒè‡ªåŠ¨åŒ–</a></p>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Build-a-git-repo-server" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/25/Build-a-git-repo-server/">Build a git repo server</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/08/25/Build-a-git-repo-server/" class="article-date">
  <time datetime="2017-08-25T13:12:54.000Z" itemprop="datePublished">2017-08-25</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="æ­¥éª¤">æ­¥éª¤</h4><p>yum install git</p>
<p>groupadd git<br>adduser git -g git<br>passwd git //è®¾ç½®å¯†ç </p>
<p>// gitç”¨æˆ·çš„ï½ç›®å½•: /home/git</p>
<p>mkdir /home/git/.ssh &amp;&amp; touch /home/git/.ssh/authorized_keys<br>chmod 700 /home/git/.ssh<br>chmod 600 /home/git/.ssh/authorized_keys</p>
<p>//æŠŠæœ¬åœ°ç”µè„‘çš„.ssh/id_rsa.pubé‡Œçš„å†…å®¹å¤åˆ¶å¹¶ç²˜è´´åˆ°è¿œç¨‹çš„/home/git/.ssh/authorized_keys, è‹¥æœ‰å¤šä¸ªåˆ™ä¸€è¡Œä¸€ä¸ª</p>
<p>//åˆå§‹åŒ–ä¸€ä¸ªå«åštestçš„ä»“åº“<br>cd /home/git &amp; git init â€“bare test.git</p>
<p>chown -R git:git test.git</p>
<p>//ç¦ç”¨shellç™»å½•<br>//1.å…ˆæ‰¾åˆ°git-shellçš„è·¯å¾„<br>grep git-shell /etc/shells || su -c â€œecho <code>which git-shell</code> &gt;&gt; /etc/shellsâ€<br>eg.æ§åˆ¶å°è¾“å‡ºï¼š/usr/bin/git-shell<br>//2.ä¿®æ”¹gitç”¨æˆ·çš„shellç™»å½•<br>vi /etc/passwd<br>//æ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¸€è¡Œï¼š<br>git:x:1001:1001:,,,:/home/git:/bin/bash<br>//æ”¹æˆ<br>git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell<br>//è¿™æ ·ï¼Œgitç”¨æˆ·å¯ä»¥æ­£å¸¸é€šè¿‡sshä½¿ç”¨gitï¼Œä½†æ— æ³•ç™»å½•shellï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºgitç”¨æˆ·æŒ‡å®šçš„git-shellæ¯æ¬¡ä¸€ç™»å½•å°±è‡ªåŠ¨é€€å‡º<br>//æµ‹è¯•ï¼š<br>ssh git@your-server-name-or-ip<br>//è¾“å…¥å¯†ç åæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯å³æˆåŠŸ<br>fatal: What do you think I am? A shell?<br>Connection to <code>your-server-name-or-ip</code> closed.<br>//ç»™gitç”¨æˆ·å¢åŠ pushæƒé™<br>usermod -s /bin/bash git</p>
<p>//åœ¨æœ¬åœ°ç”µè„‘ä¸­cloneä»“åº“<br>git clone git@your-server-name-or-ip:test.git</p>
<p>//ps. è¿™é‡Œè‹¥æœåŠ¡å™¨æ”¹äº†é»˜è®¤çš„ssh 22ç«¯å£, å¯ä»¥åœ¨æœ¬åœ°ç”µè„‘ä¸­(~/.ssh/)æ–°å»ºconfigæ–‡ä»¶<br>vi ~/.ssh/config<br>//configå†…å®¹ï¼š<br>host your-server-name-or-ip<br>hostname  your-server-name-or-ip<br>port your-server-port</p>
<p>å‡è®¾windowsä¸Šå·²ç»æœ‰ä¸ªæœ¬åœ°ä»“åº“ï¼Œå¹¶ä¸”ä¸åˆ«åå«originçš„è¿œç¨‹ä»“åº“è¿›è¡Œäº†å…³è”ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åªéœ€è¦å°†originæ‰€æŒ‡å‘çš„è¿œç¨‹ä»“åº“çš„é“¾æ¥æ”¹ä¸ºæˆ‘ä»¬åˆšæ­å»ºçš„gitæœåŠ¡å™¨ï¼š<br>git remote set-url origin git@your-server-name-or-ip:my-project.git<br>å¦‚æœæ˜¯æœ¬åœ°è¿˜æ²¡æœ‰ä»“åº“ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¹¶å°†å…¶ä¸è¿œç¨‹ä»“åº“è¿›è¡Œå…³è”ï¼š<br>git init &amp;&amp; git remote add origin git@your-server-name-or-ip:my-project.git</p>
<p>å‚è€ƒç½‘å€ï¼š<br><a href="https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E6%9E%B6%E8%AE%BE%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="external">æœåŠ¡å™¨ä¸Šçš„ Git - æ¶è®¾æœåŠ¡å™¨</a><br><a href="http://www.dabu.info/vps-set-private-git-server.html" target="_blank" rel="external">ç”¨vpsæ­å»ºç§æœ‰çš„gitæœåŠ¡å™¨</a><br><a href="http://www.pubyun.com/blog/deveops/%E6%9C%AC%E5%9C%B0ssh%E9%9D%9E%E6%A0%87%E5%87%86%E7%AB%AF%E5%8F%A3%E6%97%B6%EF%BC%8C%E8%BF%9E%E6%8E%A5github-com/" target="_blank" rel="external">æœ¬åœ°sshéæ ‡å‡†ç«¯å£æ—¶ï¼Œè¿æ¥github.com</a></p>

      

      
        
    </div>
  </div>
  
</article>



  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        <aside id="sidebar">
  <nav class="menus">
  	<ul>
  		<li><a href="/"><i class="icon icon-home"></i></a></li>
  		
			<li><a href="/archives"><i class="icon icon-fenlei"></i></a></li>
  		
  		
			<li><a href="/tags"><i class="icon icon-tag"></i></a></li>
  		
  		
  			<li><a href="https://github.com/hejianxian" target="_blank"><i class="icon icon-github"></i></a></li>
  		
  	</ul>
  </nav>
  <a id="go-top" href="#"><i class="icon icon-up"></i></a>
</aside>

      </div>
      <footer id="footer">
  
	<div id="footer-info" class="inner">
	  &copy; 2018 litt1e-p 
	  - Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	  - Theme <a href="https://github.com/hejianxian/hexo-theme-jane/" target="_blank">Jane</a>
	</div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tag</a>
  
    <a href="https://github.com/hejianxian" class="mobile-nav-link">Github</a>
  
</nav>
    
<script>
  var disqus_shortname = 'litt1ep';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>