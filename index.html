<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>litt1e-p</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="litt1e-p">
<meta property="og:url" content="https://litt1e-p.github.io/index.html">
<meta property="og:site_name" content="litt1e-p">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="litt1e-p">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="litt1e-p" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <section id="main">
  
    <article id="post-Create-a-dynamic-color-list-for-nth-child-with-SCSS-and-SASS" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/15/Create-a-dynamic-color-list-for-nth-child-with-SCSS-and-SASS/">Create a dynamic color list for nth-child with SCSS and SASS</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2019/03/15/Create-a-dynamic-color-list-for-nth-child-with-SCSS-and-SASS/" class="article-date">
  <time datetime="2019-03-15T08:27:58.000Z" itemprop="datePublished">2019-03-15</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="使用SASS或SCSS为nth-child元素设置动态颜色">使用SASS或SCSS为nth-child元素设置动态颜色</h2><h3 id="需求">需求</h3><blockquote>
<p>接到产品的需求，要求做带百分比高度的动态柱状图。</p>
</blockquote>
<p>产品原型设计图：<br><img src="https://wx1.sinaimg.cn/large/005wcR5Jgy1gcj5p6axl3j302u088t8o" alt=""></p>
<h3 id="分析">分析</h3><p>一开始的思路是用常用echarts/g2/highcharts/d3，但感觉都不太适合，干脆自己写一个。最终效果也大致还原了需求。</p>
<hr>
<p>其实这个东西也不难，主要是要利用好SACC/SCSS提供的方法，去动态生成各个nth-child的css值，这篇文章虽然只涉及到颜色，实际上每个css样式都可以动态去生成。</p>
<h3 id="实现">实现</h3><p>这里我使用的是Vue+SCSS，React什么的也可以参考。</p>
<ol>
<li>先写html。由于是动态的高度，这里给每个<code>wrap-item</code>设置动态的style</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"wrap-item"</span> <span class="attribute">:style</span>=<span class="value">"&#123;height: '12%'&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"vl"</span>&gt;</span>12%<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"wrap-item"</span> <span class="attribute">:style</span>=<span class="value">"&#123;height: '32%'&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"vl"</span>&gt;</span>32%<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"wrap-item"</span> <span class="attribute">:style</span>=<span class="value">"&#123;height: '56%'&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"vl"</span>&gt;</span>56%<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>css</li>
</ol>
<p>这里有两个地方需要注意，第一个由于每一个柱块都是百分比的动态不定高度，所以为了里面的文字能够垂直居中。我使用了table display的布局方法，还能兼容一下老IE。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.wrap-item &#123;</span><br><span class="line">  display: table;</span><br><span class="line">  color: #fff;</span><br><span class="line">  text-align: center;</span><br><span class="line">  .vl &#123;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line">    display: table-cell;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    font-weight: 450;</span><br><span class="line">    padding: 0px 6px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二点是我们要做的重点，如何利用SCSS的遍历方法去动态生成柱块颜色。假设我们有5块柱块，那么我们可以用<code>@for</code>从1-5遍历，再利用<code>darken()</code>方法让每个子项都与我们的基调色<code>$color</code>进行计算，生成不同浓度的颜色。要注意的是这些计算值只能是0-100，不然就会报错了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$color: rgba(207, 206, 240, 1);</span><br><span class="line">.wrap-item &#123;</span><br><span class="line">  @for $i from 1 through 5 &#123;</span><br><span class="line">    &amp;:nth-child(#&#123;$i&#125;) &#123;</span><br><span class="line">      background-color: darken($color, ($i - 1) * 8%);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>再加上一些hover动画效果，整个百分比动态柱块就完成了。</p>
<p>最终效果图：</p>
<p><img src="https://wx1.sinaimg.cn/large/005wcR5Jgy1gcj5r6mb0dj303q08wweg" alt=""></p>
<p>完整代码如下：</p>
<pre><code class="css">$color: rgba(207, 206, 240, 1);
.wrap-item {
  display: table;
  color: #fff;
  text-align: center;
  cursor: pointer;
  transition: scale .25s cubic-bezier(0.175, 0.885, 0.32, 1.155);
  @for $i from 1 through 7 {
    &amp;:nth-child(#{$i}) {
      background-color: darken($color, ($i - 1) * 8%);
      &amp;:hover {
        transform: scale(1.3);
      }
    }
  }
  .vl {
    vertical-align: middle;
    display: table-cell;
    font-size: 12px;
    font-weight: 450;
    padding: 0px 6px;
    pointer-events: none;
  }
}
</code></pre>
<h3 id="思考">思考</h3><p>如果我们使用<code>lighten()</code>方法或者换成<code>less</code>来写的话，又该怎么做呢?</p>
<h3 id="参考">参考</h3><ul>
<li><a href="https://sass-lang.com/documentation/values/lists" target="_blank" rel="external">sass lists</a></li>
<li><a href="https://css-tricks.com/snippets/sass/deep-getset-maps/" target="_blank" rel="external">deep-getset-maps</a></li>
<li><a href="https://stackoverflow.com/questions/44144513/how-to-create-a-dynamic-color-list-with-sass" target="_blank" rel="external">stackoverflow</a></li>
</ul>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Download-files-in-wechat" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/26/Download-files-in-wechat/">Download files in wechat</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2019/02/26/Download-files-in-wechat/" class="article-date">
  <time datetime="2019-02-26T03:43:49.000Z" itemprop="datePublished">2019-02-26</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="在企业微信网页里触发文件下载及兼容性问题">在企业微信网页里触发文件下载及兼容性问题</h2><p>在企业微信自定义网页开发文件预览功能时，官方提供了<code>wx.previewFile</code>接口可以实现。原理是<code>下载-&gt;本地预览</code>。不过对接官方的接口需要一系列的注册申请等操作，给的时间极短，直接触发文件下载应该是可行的。</p>
<p>首先考虑文件的类型，有常见的jpg/png图片和pdf，这两类都很常见，可以直接渲染或者使用pdfjs等一些插件预览，问题不大。比较麻烦的是还有Office类的word、excel、ppt等，直接触发网页下载了。</p>
<p>先判断一下文件类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.getExt = <span class="function"><span class="keyword">function</span> (<span class="params">filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> filename.substring(filename.lastIndexOf(<span class="string">'.'</span>) + <span class="number">1</span>, filename.length) || filename</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们知道，一般触发浏览器下载的方法有好几种。先试试<code>a</code>元素超链接下载：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">attachments (url = <span class="string">''</span>, attachName = <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!url) &#123;</span><br><span class="line">    <span class="keyword">this</span>.$message.error(<span class="string">'附件参数有误'</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ([<span class="string">'pdf'</span>, <span class="string">'jpg'</span>, <span class="string">'png'</span>, <span class="string">'bmp'</span>, <span class="string">'gif'</span>, <span class="string">'webp'</span>].includes(fileName.getExt())) &#123;</span><br><span class="line">    <span class="keyword">this</span>.preview(url, attachName)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.download(url, attachName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">download (url = <span class="string">''</span>, attachName) &#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">  <span class="keyword">let</span> src = <span class="string">`<span class="subst">$&#123;window.location.origin&#125;</span><span class="subst">$&#123;url&#125;</span>`</span></span><br><span class="line">  el.download = attachName</span><br><span class="line">  el.href = src</span><br><span class="line">  el.click()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写完测试一看。不管是iOS还是android，都可以提示下载，但都下载失败…</p>
<p>再试试iframe下载：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">download (url = <span class="string">''</span>, attachName = <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">  iframe.style.display = <span class="string">'none'</span></span><br><span class="line">  iframe.src = url</span><br><span class="line">  <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].appendChild(iframe)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再用微信试试打开附件，结果：android可以弹出下载并可以调用手机的app进行预览，但是iOS却仍然毫无反应。为啥？难道要用<code>blob</code>下载?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">download(url = <span class="string">''</span>, attachName = <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> accepts = &#123;</span><br><span class="line">    <span class="string">'doc'</span>: <span class="string">'application/msword'</span>,</span><br><span class="line">    <span class="string">'xls'</span>: <span class="string">'application/vnd.ms-excel'</span>,</span><br><span class="line">    <span class="string">'xlsx'</span>: <span class="string">'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span></span><br><span class="line">  &#125;</span><br><span class="line">  fetch(url).then(resp =&gt; resp.arrayBuffer()).then(resp =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([resp], &#123;type: accepts[url.getExt()]&#125;)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.navigator.msSaveOrOpenBlob) &#123;</span><br><span class="line">      <span class="built_in">window</span>.navigator.msSaveOrOpenBlob(blob, attachName)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(el)</span><br><span class="line">      <span class="keyword">const</span> url = <span class="built_in">window</span>.URL.createObjectURL(blob)</span><br><span class="line">      el.href = url</span><br><span class="line">      el.download = attachName</span><br><span class="line">      el.click()</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        <span class="built_in">window</span>.URL.revokeObjectURL(url)</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(el)</span><br><span class="line">      &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再试，还是不行，这下是android和iOS都没反应了。<br>看来需要区分android和iOS，android调用iframe，iOS另外处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">download (url = <span class="string">''</span>, attachName = <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/iphone/i</span>.test(<span class="built_in">window</span>.navigator.userAgent)) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">    iframe.style.display = <span class="string">'none'</span></span><br><span class="line">    iframe.src = url</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].appendChild(iframe)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 再试试a链接下载</span></span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">    el.download = attachName</span><br><span class="line">    <span class="keyword">let</span> src = <span class="string">`<span class="subst">$&#123;window.location.origin&#125;</span><span class="subst">$&#123;url&#125;</span>`</span></span><br><span class="line">    el.href = src</span><br><span class="line">    el.click()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果还是iOS不行，换个文件看看，居然有些文件可以，这就有点奇怪了，调试看看：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">download (url = <span class="string">''</span>, attachName = <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/iphone/i</span>.test(<span class="built_in">window</span>.navigator.userAgent)) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">    iframe.style.display = <span class="string">'none'</span></span><br><span class="line">    iframe.src = url</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].appendChild(iframe)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(url, attachName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一刷新，终于看出差别，有些attachName是中文，有些很长很长的名字。干脆全部处理一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">download (url = <span class="string">''</span>, attachName = <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/iphone/i</span>.test(<span class="built_in">window</span>.navigator.userAgent)) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">    iframe.style.display = <span class="string">'none'</span></span><br><span class="line">    iframe.src = url</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].appendChild(iframe)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fileName = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() + url.getExt()</span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">    el.download = fileName</span><br><span class="line">    <span class="keyword">let</span> src = <span class="string">`<span class="subst">$&#123;window.location.origin&#125;</span><span class="subst">$&#123;url&#125;</span>`</span></span><br><span class="line">    el.href = src</span><br><span class="line">    el.click()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这次为a元素的download也赋个值，iOS终于弹出下载和提示用什么app开启预览了。</p>
<h2 id="总结">总结</h2><p>因为在企业微信环境里，跟常见的浏览器不太同，根据以前做原生app的经验，猜测出错的原因有两个：</p>
<ul>
<li>iOS本身的UIWebView(也可能是WKWebView)对中文文件名编码解析出错了</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType &#123;&#10;  // &#36825;&#37324;&#21487;&#20197;debug&#30475;&#30475;&#20250;&#19981;&#20250;throw error&#20986;&#26469;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>企业微信对附件的拦截</li>
</ul>
<p>这种无解，老老实实使用官方提供的api:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wx.previewImage()</span><br><span class="line">wx.previewFile()</span><br></pre></td></tr></table></figure>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Use-autoclosure-to-simplify-swift-syntax" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/07/Elegant-Swift-Use-autoclosure-to-simplify-swift-syntax/">Elegant Swift -- Use @autoclosure to simplify swift syntax</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/03/07/Elegant-Swift-Use-autoclosure-to-simplify-swift-syntax/" class="article-date">
  <time datetime="2018-03-07T10:07:10.000Z" itemprop="datePublished">2018-03-07</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="优雅的Swift-使用@autoclosure简化语法">优雅的Swift-使用@autoclosure简化语法</h2><p>在swift中，@autoclosure属性常用于closure闭包中参数传递值时的简化表达，简而言之，可以在闭包参数传递时不用再使用花括号{}。</p>
<p>举个简单的例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">foo1</span><span class="params">(<span class="number">_</span> lhs: <span class="params">()</span></span></span> -&gt; <span class="type">Int</span>, <span class="number">_</span> rhs: () -&gt; <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(lhs)</span> &amp; <span class="subst">\(rhs)</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">foo2</span><span class="params">(<span class="number">_</span> lhs: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">String</span>, <span class="number">_</span> rhs: <span class="preprocessor">@autoclosure</span> () -&gt; <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(lhs)</span> &amp; <span class="subst">\(rhs)</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若不使用<code>@autoclosure</code>属性，如foo1, 调用时：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">foo1</span><span class="params">(&#123;<span class="number">1</span>&#125;, &#123;<span class="string">"true"</span>&#125;)</span></span></span><br></pre></td></tr></table></figure>
<p>假如加入了<code>@autoclosure</code>属性，如foo2, 则：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">foo2</span><span class="params">(<span class="number">1</span>+<span class="number">2</span>, <span class="string">"true"</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>是不是简单多了？</p>
<h4 id="@autoclosure黑魔法">@autoclosure黑魔法</h4><blockquote>
<p><strong>动态类型指定</strong></p>
</blockquote>
<p>当我们不知道某些变量的类型时，如在UserDefault中、在数据库中、在Dictionary中时，通常我们会在解包取值的时候赋值一个默认值并且指定类型：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> score = (UserDefaults.standard.<span class="keyword">value</span>(forKey: <span class="string">"SomeKey"</span>) <span class="keyword">as</span>? Int) ?? <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>这样的写法，不仅可读性非常差，而且还不太优雅。如果利用<code>@autoclosure</code>属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UserDefaults</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">value</span><span class="generics">&lt;T&gt;</span><span class="params">(forKey key: String, defaultValue: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> value = <span class="keyword">self</span>.value(forKey: key) <span class="keyword">as</span>? <span class="type">T</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> defaultValue()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">val</span> = <span class="type">UserDefaults</span>.standard.<span class="keyword">value</span>(forKey: <span class="string">"SomeKey"</span>, defaultValue: <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>结果中的val的类型则由defaultValue参数的类型决定。对比常规写法，是不是优雅多了？</p>
<h4 id="注意点">注意点</h4><p><code>@autoclosure</code>默认是<code>nonescape</code>的，如果我们需要在<code>@autoclosure</code>的基础上做进一步的说明，指明这个闭包参数是可逃逸的。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func foo<span class="function"><span class="params">(f: <span class="property">@autoclosure</span>(escaping) () -&gt; ())</span> &#123;</span><br><span class="line">    <span class="title">f</span><span class="params">()</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="参考文章">参考文章</h5><blockquote>
<p><a href="https://medium.com/@johnsundell/using-autoclosure-when-designing-swift-apis-67fe20a8b2e" target="_blank" rel="external">https://medium.com/@johnsundell/using-autoclosure-when-designing-swift-apis-67fe20a8b2e</a></p>
</blockquote>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-URL" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/18/Elegant-Swift-URL/">Elegant Swift -- URL</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/02/18/Elegant-Swift-URL/" class="article-date">
  <time datetime="2018-02-18T11:29:13.000Z" itemprop="datePublished">2018-02-18</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="优雅的Swift_–_烦人的URL">优雅的Swift – 烦人的URL</h2><p>在日常coding中，对于URL传参，时常会误传了string类型的url，如：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">"https://www.github.com"</span></span><br><span class="line"><span class="keyword">let</span> task = URLSession.<span class="keyword">shared</span>.dataTask(<span class="keyword">with</span>: url)</span><br></pre></td></tr></table></figure>
<p>然后是编译器报错，然后又悻悻加上<code>URL(string: &quot;url address&quot;)</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let url = <span class="string">"https://www.github.com"</span></span><br><span class="line">let task = URLSession<span class="class">.shared</span><span class="class">.dataTask</span>(with: <span class="function"><span class="title">URL</span><span class="params">(string: url)</span></span>)</span><br></pre></td></tr></table></figure>
<p>有没有一种优雅的方式，让我们直接就输入String类型的网址url，自动识别转换成为URL类型的参数呢？</p>
<p>答案是有的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">URL</span>: <span class="title">ExpressibleByStringLiteral</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// By using 'StaticString' we disable string interpolation, for safety</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(stringLiteral value: <span class="type">StaticString</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span> = <span class="type">URL</span>(string: <span class="string">"<span class="subst">\(value)</span>"</span>).require(hint: <span class="string">"Invalid URL string literal: <span class="subst">\(value)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let task = URLSession<span class="class">.shared</span><span class="class">.dataTask</span>(with: <span class="string">"https://www.github.com"</span>)</span><br></pre></td></tr></table></figure>
<p>优雅一句话搞定，妈妈再也不用担心我忘记写<code>URL(string:)</code>了。</p>
<blockquote>
<p>这里的require也是一个extension方法，为了增加安全性判断</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 强制要求这个 optional 不为空</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">/// - hint: 为空抛出的错误信息</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Returns: optional 的值.</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">require</span><span class="params">(hint hintExpression: @autoclosure<span class="params">()</span></span></span> -&gt; <span class="type">String</span>? = <span class="literal">nil</span>, file: <span class="type">StaticString</span> = #file, line: <span class="type">UInt</span> = #line) -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> unwrapped = <span class="keyword">self</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> message = <span class="string">"required value was nil <span class="subst">\(file)</span>, at line <span class="subst">\(line)</span>"</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> hint = hintExpression() &#123;</span><br><span class="line">                message.append(<span class="string">". Debugging hit: <span class="subst">\(hint)</span>"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            #<span class="keyword">if</span> !os(<span class="type">Linux</span>)</span><br><span class="line">            <span class="keyword">let</span> exception = <span class="type">NSException</span>(name: .invalidArgumentException,</span><br><span class="line">                                        reason: message,</span><br><span class="line">                                        userInfo: <span class="literal">nil</span>)</span><br><span class="line">            exception.raise()</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            <span class="built_in">preconditionFailure</span>(message)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> unwrapped</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结">总结</h4><p>这只是一个简单的思路，抛砖引玉，大家可以发散开来，为其他类型或者方法写更多更优雅的代码。</p>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-UnWrapped-or-Default-Value" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/01/Elegant-Swift-UnWrapped-or-Default-Value/">Elegant Swift -- UnWrapped or Default Value</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/02/01/Elegant-Swift-UnWrapped-or-Default-Value/" class="article-date">
  <time datetime="2018-02-01T14:18:10.000Z" itemprop="datePublished">2018-02-01</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="优雅的Swift–解包">优雅的Swift–解包</h2><p>通常我们在swift中对可选值类型(optional)进行解包(unwrapped)操作时，<br>会进行一些常规的判断，如：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="built_in">String</span>?</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> _ = a &#123;</span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再进行解包操作。那么有没有更加优雅的方式呢？</p>
<ul>
<li>利用extension进行解包</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">@discardableResult</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">ifSome</span><span class="params">(<span class="number">_</span> closure: <span class="params">(Wrapped)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Optional</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .some(<span class="keyword">let</span> wrapped): closure(wrapped); <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    <span class="keyword">case</span> .<span class="keyword">none</span>: <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@discardableResult</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">ifNone</span><span class="params">(<span class="number">_</span> closure: <span class="params">()</span></span></span> -&gt; ()) -&gt; <span class="type">Optional</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> .some: <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">case</span> .<span class="keyword">none</span>: closure(); <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释： <code>ifSome</code>方法利用了extension给可选值进行内部解包操作，通过传入一个closure进行是否需要解包的判断之后执行closure，<code>ifNone</code>亦同理。</p>
<p>使用方法</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let <span class="operator">a</span>: String? = <span class="string">"str"</span></span><br><span class="line"><span class="operator">a</span>.ifSome(&#123;</span><br><span class="line"><span class="comment"> //do something</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="operator">a</span>.ifNone(&#123;</span><br><span class="line"><span class="comment"> //do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>利用extension赋予默认值</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> `<span class="title">or</span>`<span class="params">(<span class="number">_</span> value: Wrapped)</span></span> -&gt; <span class="type">Wrapped</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span> ?? value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释：不解释了，简单。</p>
<p>使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a: <span class="built_in">String</span>? = nil</span><br><span class="line"><span class="keyword">let</span> v = a.or(<span class="string">"b"</span>)</span><br></pre></td></tr></table></figure>
<p>到这里有人就会问了，直接使用<code>??</code>进行解包及默认值赋值不更简单吗？</p>
<p>没错，看起来是写更少的代码看起来更简单了，实际上使用extension的这样的方法在写法上会增加可读性，因为本来的可选类型(Optional)解包时就带了个<code>?</code>, 太多<code>?</code>写在一起比语义化的<code>or</code>会降低代码的可读性。不管如何，见仁见智了。</p>
<h5 id="参考资料">参考资料</h5><blockquote>
<p><a href="https://medium.com/swift-snippets/swift-snippet-7-optional-cd9869b8b569" target="_blank" rel="external">https://medium.com/swift-snippets/swift-snippet-7-optional-cd9869b8b569</a></p>
</blockquote>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Range" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/17/Elegant-Swift-Range/">Elegant Swift -- Range</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/17/Elegant-Swift-Range/" class="article-date">
  <time datetime="2018-01-17T12:56:45.000Z" itemprop="datePublished">2018-01-17</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="优雅的Swift–范围判断(～=操作符)">优雅的Swift–范围判断(～=操作符)</h2><p>我们对数组取值是否越界进行判断，通常的写法是：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">item</span><span class="params">(at index: Int, array: Array&lt;Element&gt;)</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">    <span class="keyword">guard</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; array.<span class="built_in">count</span> - <span class="number">1</span> &#123; <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">nil</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> array[index]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者优雅一点写成这样：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">item</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; <span class="keyword">self</span>.<span class="built_in">count</span> - <span class="number">1</span> &#123; <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">nil</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>[index]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有没有更优雅的写法呢？看看下面这样写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">item</span><span class="params">(at index: Int)</span></span> -&gt; <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> startIndex..&lt;endIndex ~= index <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>[index]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是不是更加优雅点了呢？</p>
<p>操作符Operator<code>~=</code>其实是用于匹配case操作的，下面举个简单的例子：</p>
<ol>
<li>先定义一个struct</li>
</ol>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pet</span> </span>&#123;</span><br><span class="line">    let name: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>再implement<code>~=</code>方法</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> ~=<span class="params">(pattern: String, value: Pet)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value.name == pattern</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>使用</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="type">Pet</span>(name: <span class="string">"Poly"</span>)</span><br><span class="line"><span class="keyword">switch</span> p &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"Poly"</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"I am Poly"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"no me"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>当调用<code>case</code>时，会调用我们自定义的<code>~=</code>方法进行判断</strong></p>
<p>或者这样判断也会调用自定义的<code>~=</code>方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> <span class="string">"Poly"</span> = p &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"It's still me!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由此得知Array的extension方法中的<code>startIndex..&lt;endIndex ~= index</code>同样是调用了在其内部实现的<code>~=</code>方法。</p>
<h4 id="~=_的更多示例"><code>~=</code> 的更多示例</h4><ul>
<li>1 检测变量n是否在指定范围内(10~100)</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let n: Int = <span class="number">100</span></span><br><span class="line"><span class="comment">// using "patterns"</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">10.</span>.<span class="number">.100</span> ~= n&#123;</span><br><span class="line">    print(<span class="string">"inside!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>2 检测http响应值</li>
</ul>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="built_in">response</span> = <span class="built_in">response</span> as? HTTPURLResponse , <span class="number">200.</span>.<span class="number">.299</span> ~= <span class="built_in">response</span>.statusCode &#123;</span><br><span class="line">    <span class="keyword">let</span> contentLength : Int64 = <span class="built_in">response</span>.expectedContentLength</span><br><span class="line">    completionHandler(contentLength)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    completionHandler(nil)</span><br></pre></td></tr></table></figure>
<h5 id="参考文章">参考文章</h5><blockquote>
<p><a href="https://stackoverflow.com/questions/38371870/operator-in-swift" target="_blank" rel="external">https://stackoverflow.com/questions/38371870/operator-in-swift</a></p>
</blockquote>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Operator" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/Elegant-Swift-Operator/">Elegant Swift -- Operator</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/14/Elegant-Swift-Operator/" class="article-date">
  <time datetime="2018-01-14T15:54:58.000Z" itemprop="datePublished">2018-01-14</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="优雅的Swift_–_自定义操作符(Operator)">优雅的Swift – 自定义操作符(Operator)</h2><p>自从有了extension后，swift写出的代码变得优雅了许多。我们常会看到一些开源的第三方库会出现一些诡异的符号。比如著名的json解析库<a href="https://github.com/hkellaway/Gloss" target="_blank" rel="external">gloss</a>中的<code>~~&gt;</code>、<code>&lt;~~</code>，还有<a href="https://github.com/thoughtbot/Argo" target="_blank" rel="external">Argo</a>中的<code>&lt;^&gt;</code>、<code>&lt;*&gt;</code>、<code>&lt;|</code>、<code>&lt;|?</code>、<code>&lt;||</code>等等。</p>
<p>这种叫做操作符(Operator)的东西实际上比extension更加地优雅，因为不用再写个方法名来调用，简单一个符号即可神奇地达到调用的目的。</p>
<p>下面我们来自定义一个操作符，来实现简单base64加密的功能。</p>
<h5 id="基本概念">基本概念</h5><p>1.运算符定义</p>
<ul>
<li>prefix 表示定义一个前位操作符（前是输入）</li>
<li>infix 表示定义一个中位操作符（前后都是输入）</li>
<li>postfix 表示定义一个后位操作符（后是输入）</li>
</ul>
<p>2.结合律 associativity (计算顺序)</p>
<ul>
<li>left （从左往右的顺序）</li>
<li>right（从右往左的顺序）</li>
<li>none（默认就为 none，不会再结合）</li>
</ul>
<p>3.优先级 Precedence</p>
<ul>
<li>higherThan 优先级高于</li>
<li>lowerThan 优先级低于</li>
</ul>
<p>常用的Precedence，详见<a href="https://developer.apple.com/documentation/swift/operator_declarations" target="_blank" rel="external">官方文档</a></p>
<p>我们也可以自定义一个Precedence。</p>
<h5 id="实战">实战</h5><p>简单用一个自定义操作符，实现base64加密和解密功能。</p>
<ol>
<li><p>先定义一个优先级group</p>
 <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">precedencegroup</span> <span class="tag">MyPrecedence</span> &#123;</span><br><span class="line"> <span class="attribute">associativity</span>: none</span><br><span class="line"> <span class="attribute">higherThan</span>: AdditionPrecedence</span><br><span class="line"> <span class="attribute">lowerThan</span>: MultiplicationPrecedence</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 这里associativity因为没有前后输入顺序就直接使用默认的none，Precedence我们比加法(AdditionPrecedence)高，比乘法(MultiplicationPrecedence)低就行了，因为如果是数字遇到运算需要进行优先级的判断。</p>
</li>
<li><p>定义一个操作符</p>
 <figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="infix"><span class="keyword">infix</span> operator *=* : MyPrecedence</span></span><br></pre></td></tr></table></figure>
<p> 这里定义一个中位操作符</p>
</li>
<li><p>实现功能的方法</p>
 <figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> enum CryptoType &#123;</span><br><span class="line">    <span class="keyword">case</span> encrypt, decrypt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func *=* (input: <span class="built_in">String</span>, <span class="keyword">type</span>: CryptoType) <span class="subst">-&gt; </span><span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">type</span> == <span class="built_in">.</span>encrypt &#123;</span><br><span class="line">        guard <span class="keyword">let</span> utf8Data = input<span class="built_in">.</span><span class="built_in">data</span>(using: <span class="built_in">String</span><span class="built_in">.</span>Encoding<span class="built_in">.</span>utf8) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">String</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> utf8Data<span class="built_in">.</span>base64EncodedString()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        guard <span class="keyword">let</span> utf8Data = <span class="built_in">Data</span>(base64Encoded: input) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">String</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(<span class="built_in">data</span>: utf8Data, encoding: <span class="built_in">.</span>utf8) ?? <span class="built_in">String</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 这里声明一个枚举，动态切换加密或者解密操作。</p>
</li>
<li><p>测试</p>
 <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let <span class="operator">a</span> = <span class="string">"1234567890"</span> *=* .<span class="built_in">encrypt</span></span><br><span class="line">print(<span class="operator">a</span>)<span class="comment"> // MTIzNDU2Nzg5MA==</span></span><br><span class="line">let b = <span class="operator">a</span> *=* .<span class="built_in">decrypt</span></span><br><span class="line">print(b)<span class="comment"> // 1234567890</span></span><br></pre></td></tr></table></figure>
<p> 大功告成。撒花🎉🎉🎉</p>
</li>
</ol>
<h5 id="总结">总结</h5><p>使用自定义操作符，可以大大提高代码优(zhuang)雅(bi)性，相对于extension更加简洁明了。但是要注意，自定义操作符的作用域是全局的，可能会存在一些风险，慎重使用。</p>
<h5 id="参考资料">参考资料</h5><blockquote>
<p><a href="https://developer.apple.com/documentation/swift/operator_declarations#topic-content" target="_blank" rel="external">https://developer.apple.com/documentation/swift/operator_declarations#topic-content</a></p>
<p><a href="https://stackoverflow.com/questions/45134496/understanding-precedence-groups-assignment-in-swift-3-1" target="_blank" rel="external">https://stackoverflow.com/questions/45134496/understanding-precedence-groups-assignment-in-swift-3-1</a>;</p>
<p><a href="https://github.com/NSCookies/articles/blob/master/publish/%E8%A3%85%E4%B8%AA%E9%80%BC%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6.md" target="_blank" rel="external">https://github.com/NSCookies/articles/blob/master/publish/%E8%A3%85%E4%B8%AA%E9%80%BC%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6.md</a></p>
</blockquote>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Elegant-Swift-Generic-typealias-in-closure" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/09/Elegant-Swift-Generic-typealias-in-closure/">Elegant Swift -- Generic typealias in closure</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/09/Elegant-Swift-Generic-typealias-in-closure/" class="article-date">
  <time datetime="2018-01-09T12:33:39.000Z" itemprop="datePublished">2018-01-09</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="优雅的Swift_–_闭包中的范型">优雅的Swift – 闭包中的范型</h2><p>从swift 3开始有了范型(Generic type), 范型除了常用在方法里作参数的声明之外，其实还可以使用于闭包(Closure)回调中，据此可以使用任何类型在closure中。</p>
<h4 id="示例">示例</h4><p>我们可以先定义一个简单的closure:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">typealias Closure&lt;T&gt; = <span class="function"><span class="params">(T)</span> -&gt;</span> Void</span><br><span class="line"><span class="regexp">//</span>返回值为空</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<ul>
<li>1 使用Bool类型</li>
</ul>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> boolClosure: Closure&lt;<span class="built_in">Bool</span>&gt; = &#123; boolValue <span class="keyword">in</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">boolClosure(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>2 使用String类型</li>
</ul>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> strClosure: Closure&lt;<span class="built_in">String</span>&gt; = &#123; strValue <span class="keyword">in</span></span><br><span class="line">    <span class="attribute">...</span></span><br><span class="line">&#125;</span><br><span class="line">strClosure(<span class="string">"I am string"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>3 其他类型同理</li>
</ul>
<h4 id="更多Closure示例">更多Closure示例</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typealias Closure&lt;T, U&gt; = <span class="function"><span class="params">(T)</span> -&gt;</span> (U)</span><br><span class="line"></span><br><span class="line">typealias Closure&lt;T&gt; = <span class="function"><span class="params">(T)</span> -&gt;</span> Void</span><br><span class="line"></span><br><span class="line">typealias Closure&lt;T&gt; = <span class="function"><span class="params">()</span> -&gt;</span> T</span><br><span class="line"></span><br><span class="line">typealias Closure = <span class="function"><span class="params">()</span> -&gt;</span> Void</span><br></pre></td></tr></table></figure>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Use-ES7-async-await-in-Wechat-app" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/07/Use-ES7-async-await-in-Wechat-app/">Use ES7 async&amp;await in Wechat app</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/01/07/Use-ES7-async-await-in-Wechat-app/" class="article-date">
  <time datetime="2018-01-07T11:06:45.000Z" itemprop="datePublished">2018-01-07</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="在微信小程序中使用_ES7_async&amp;await">在微信小程序中使用 ES7 async&amp;await</h2><p>微信小程序虽然已经支持Promiss，在一定程度上缓解了臭名昭著的callback hell：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            resolve(&#123;data: <span class="string">"Hello,World"</span>&#125;)</span><br><span class="line">        &#125;, <span class="number">5000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是仍不够解耦不够优雅，若是支持ES7的async和await就好了，可惜微信MINA IDE还不支持这个特性，只能自己动手实现了。</p>
<h4 id="原理">原理</h4><p>首先，async/await也是和Promise配合使用的。具体语法不一一赘述，详见<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="external">ES7 Async Await</a></p>
<p>这里举个简单的使用例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wxLogin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        wx.login(&#123;</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (r.code) &#123;</span><br><span class="line">                    resolve(r)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(<span class="string">'获取用户登录状态失败！'</span> + r.errMsg)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: <span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                reject(<span class="string">'获取用户登录状态失败'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">tryLogin</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rs = <span class="keyword">await</span> wxLogin().catch(e =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.info(e)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">"logined!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tryLogin()</span><br></pre></td></tr></table></figure>
<p>是不是优雅多了。跟callback hell say byebye.</p>
<h4 id="配置">配置</h4><p>那么又该如何实现呢？微信MINA自带了Babel转换工具，但不够强大，这里我们自己来配置一个Babel来转换编译我们的代码。</p>
<p>所以，我们先把MINA里的<code>开启ES6转ES5</code>关闭，我们用自己的Babel。</p>
<p><img src="https://wx1.sinaimg.cn/large/006tKfTcgy1fp32ylaplyj311c0ak75l.jpg" alt=""></p>
<p>然后用Gulp来写我的脚本，从Gulp中调用Babel来编译我的代码。z在调用Babel时，需要给我们的Babel配置插件以支持async/await，比如async-to-generator，async-generator-functions等插件。</p>
<ol>
<li><p>Babel的配置</p>
<p> 编辑Babel的配置文件：.babelrc，这里直接用<code>latest</code>，便支持ES7。</p>
 <figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//.<span class="atom">babelrc</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"presets"</span>: [ <span class="string">"latest"</span> ],  </span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Glup的配置</p>
<p> 把我们小程序项目下所有的js文件都通过Babel编译：</p>
 <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">gulp.<span class="keyword">task</span>(<span class="string">'scripts'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([<span class="string">'./src/**/*.js'</span>])</span><br><span class="line">        .pipe(babel())</span><br><span class="line">        .pipe(gulpAddRequireRuntime())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function gulpAddRequireRuntime() &#123;</span><br><span class="line">    <span class="keyword">return</span> through.obj(function(<span class="keyword">file</span>, enc, cb) &#123;</span><br><span class="line">        var prefixText = ``;</span><br><span class="line">        var rel = path.relative(path.dirname(<span class="keyword">file</span>.path), path.<span class="keyword">join</span>(<span class="keyword">file</span>.base, <span class="string">'lib/runtime.js'</span>));</span><br><span class="line">        rel = rel.replace(<span class="regexp">/\\/g</span>, <span class="string">'/'</span>);</span><br><span class="line">        <span class="keyword">if</span> (rel === <span class="string">'runtime.js'</span>) &#123;</span><br><span class="line">            prefixText = <span class="keyword">new</span> Buffer(prefixText);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            prefixText = `var regeneratorRuntime = require(<span class="string">"$&#123;rel&#125;"</span>);`;</span><br><span class="line">            prefixText = <span class="keyword">new</span> Buffer(prefixText);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">file</span>.isNull()) &#123;</span><br><span class="line">            cb(<span class="keyword">null</span>, <span class="keyword">file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">file</span>.isBuffer()) &#123;</span><br><span class="line">            <span class="keyword">file</span>.contents = Buffer.concat([prefixText, <span class="keyword">file</span>.contents]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">file</span>.isStream()) &#123;</span><br><span class="line">            <span class="keyword">file</span>.contents = <span class="keyword">file</span>.contents.pipe(prefixStream(prefixText));</span><br><span class="line">        &#125;</span><br><span class="line">        cb(<span class="keyword">null</span>, <span class="keyword">file</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="使用">使用</h4><ol>
<li>项目目录结构</li>
</ol>
<p>![](<a href="https://wx1.sinaimg.cn/large/006tKfTcgy1fp3384dryfj30mu0e675n.jpg" target="_blank" rel="external">https://wx1.sinaimg.cn/large/006tKfTcgy1fp3384dryfj30mu0e675n.jpg</a></p>
<p>如图，这里dist目录正是Gulp编译输出目录，在微信MINA中直接用这个目录即可，而src目录则为我们愉快编写ES7的async&amp;await的目录啦。</p>
<ol>
<li>依赖库</li>
</ol>
<p>经过Babel转译后的代码是通过类似co库的方式来实现的，即需要使用到generator，所以，和我们使用co的时候一样，需要依赖一个regeneratorRuntime，才能支持generator特性。我们这使用Facebook开源的<a href="https://github.com/facebook/regenerator/" target="_blank" rel="external">regenerator</a>。</p>
<p>安装regenerator</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> regenerator</span></span><br></pre></td></tr></table></figure>
<ol>
<li>引入</li>
</ol>
<p>把刚才npm安装的regenerator下的<code>rumtime.js</code>复制到我们的src/lib下，然后在需要使用的地方引入即可愉快又优雅地写我们的async/await代码啦。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const RUNTIME = <span class="function"><span class="title">require</span><span class="params">(<span class="string">"/lib/runtime"</span>)</span></span></span><br></pre></td></tr></table></figure>
<h5 id="参考资料">参考资料</h5><blockquote>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function</a><br><a href="https://www.jianshu.com/p/270f129e5af3" target="_blank" rel="external">https://www.jianshu.com/p/270f129e5af3</a></p>
</blockquote>

      

      

    </div>
  </div>
  
</article>



  
    <article id="post-Build-a-notification-center-for-wechat-app" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/Build-a-notification-center-for-wechat-app/">Build a notification center for wechat app</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/12/30/Build-a-notification-center-for-wechat-app/" class="article-date">
  <time datetime="2017-12-30T02:30:15.000Z" itemprop="datePublished">2017-12-30</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="为微信小程序建立通知中心">为微信小程序建立通知中心</h2><p>微信小程序目前为止，页面传值的方式主要有：</p>
<ul>
<li>globalData 全局共享变量</li>
<li>wx.navigateTo等页面之间跳转的url传值，在目标页<code>onLoad</code>中获取</li>
<li>wx.setStorage缓存变量</li>
<li>其他？(欢迎补充)</li>
</ul>
<p>做过app，特别是iOS app的同学肯定知道原生app除了上述的方式还有众多的传值甚至反向传值方式，如block，delegate传值，kvo等，其中最少不了的是一对多的<code>NotificationCenter/NSNotificationCenter</code>，做WeChat app时怎么可以没有通知中心呢，GitHub上也有一位<br>国内的程序员写一个类似通知中心的js库叫<a href="https://github.com/binnng/broadcast.js" target="_blank" rel="external">broadcast.js</a>，原理也是大致相同，从注册通知到通知中心发送通知、收到通知，源码比较简单，只有30行左右，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> WIN, broadcast;</span><br><span class="line"></span><br><span class="line">WIN = <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">broadcast = &#123;</span><br><span class="line">  on: <span class="function"><span class="keyword">function</span>(<span class="params">name, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> eventData;</span><br><span class="line">    eventData = broadcast.data;</span><br><span class="line">    <span class="keyword">if</span> (eventData.hasOwnProperty(name)) &#123;</span><br><span class="line">      eventData[name].push(fn);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      eventData[name] = [fn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  fire: <span class="function"><span class="keyword">function</span>(<span class="params">name, data, thisArg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fn, fnList, i, len;</span><br><span class="line">    thisArg = thisArg || WIN;</span><br><span class="line">    fnList = broadcast.data[name];</span><br><span class="line">    <span class="keyword">if</span> (!fnList.length) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Cannot find broadcast event "</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, len = fnList.length; i &lt; len; i++) &#123;</span><br><span class="line">      fn = fnList[i];</span><br><span class="line">      fn.apply(thisArg, [data, name]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = broadcast;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  WIN.broadcast = broadcast;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大体上思路是正确的，但存在bug，在判断待通知的事件数组fnList时，源码直接判断<code>if (!fnList.length)</code>就throw error，在实际使用中会crash，因为可能找不到对应事件的名字，也就是说发送通知时如果发送一个未注册的通知的话，fnList都还是null或者undefined的。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在调用发送通知前，必须先注册该通知</span></span><br><span class="line">broadcast.reg(config.kAppTestNotificationKey, <span class="function"><span class="keyword">function</span> <span class="params">(cb)</span> </span>&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>这其实相当尴尬，我决定把它修改一下，顺便把方法名也一起修改一下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> WIN, notificationCenter;</span><br><span class="line">WIN = <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line">notificationCenter = &#123;</span><br><span class="line">    addObserver: <span class="function"><span class="keyword">function</span>(<span class="params">name, fn</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> eventData;</span><br><span class="line">        eventData = notificationCenter.data;</span><br><span class="line">        <span class="keyword">if</span> (eventData.hasOwnProperty(name)) &#123;</span><br><span class="line">            eventData[name].push(fn);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            eventData[name] = [fn];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    post: <span class="function"><span class="keyword">function</span>(<span class="params">name, data, thisArg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> fn, fnList, i, len;</span><br><span class="line">        thisArg = thisArg || WIN;</span><br><span class="line">        fnList = notificationCenter.data[name];</span><br><span class="line">        <span class="keyword">if</span> (!fnList || !fnList.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Cannot find notificationCenter event "</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>, len = fnList.length; i &lt; len; i++) &#123;</span><br><span class="line">            fn = fnList[i];</span><br><span class="line">            fn.apply(thisArg, [data, name]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    data: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> exports !== <span class="string">"undefined"</span> &amp;&amp; <span class="built_in">module</span>.exports) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = notificationCenter;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    WIN.notificationCenter = notificationCenter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在发送一个未注册的通知时也不会throw error了，可是，这代码仍然还有bug：这个notificationCenter自身的事件对象<code>data</code>中储存着所有事件，其实数据结构为：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"noti1"</span>: [<span class="literal">k1</span>, <span class="literal">k2</span>, ...],</span><br><span class="line">    <span class="string">"noti2"</span>: [<span class="literal">k1</span>, <span class="literal">k2</span>, ...],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并没有提供removeObserver移除事件通知的方法，其造成对象内部数组的无限增加，在每一次发送通知时遍历时间会无限增加，时间复杂度O(n)会随着通知对象及其内部事件数组数量增加而增加。为此应该再修改一下，增加一个移除事件通知的方法：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">removeObserver: <span class="function"><span class="keyword">function</span><span class="params">(name, fn)</span> &#123;</span></span><br><span class="line">    var eventData, fnList, <span class="built_in">i</span>, len;</span><br><span class="line">    eventData = notificationCenter.data;</span><br><span class="line">    fnList = notificationCenter.data<span class="matrix">[name]</span>;</span><br><span class="line">    <span class="keyword">if</span> (!fnList || !fnList.<span class="built_in">length</span>) <span class="cell">&#123;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>, len = fnList.<span class="built_in">length</span>; <span class="built_in">i</span> &lt; len; <span class="built_in">i</span>++) <span class="cell">&#123;</span><br><span class="line">        if (fnList[i] == fn) &#123;</span><br><span class="line">            fnList.splice(i, <span class="number">1</span>)</span><br><span class="line">        &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> this;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>现在好了，有<code>addObserver</code>、<code>post</code>、<code>removeObserver</code>方法了，大体上满足了我们的使用要求，是否已经完美了呢？</p>
<p>答案是否定的，为什么呢？不妨想想看，这个通知中心库，在每一个需要使用的page里都需要进行一次引入操作：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">var</span> notificationCenter = <span class="function"><span class="title">require</span><span class="params">(<span class="string">"./lib/notificationCenter"</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>有些人就会疑虑了：这每require一次，是不是都new了一次这个notificationCenter？如果是的话，意味着这个notificationCenter并不是一个单例，然后不同地方require生成不同的对象，甚至还有线程争夺的问题……</p>
<p>事实真的如此吗？其实在node.js官方文档中，说明了require是引入一个单例</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Every call <span class="built_in">to</span> <span class="built_in">require</span>(<span class="string">'foo'</span>) will <span class="built_in">get</span> exactly <span class="operator">the</span> same object returned, <span class="keyword">if</span> <span class="keyword">it</span> would <span class="built_in">resolve</span> <span class="built_in">to</span> <span class="operator">the</span> same <span class="built_in">file</span>.</span><br></pre></td></tr></table></figure>
<p>举个<a href="https://medium.com/@lazlojuly/are-node-js-modules-singletons-764ae97519af" target="_blank" rel="external">medium</a>例子：</p>
<p>定义一个类</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> counter.js</span><br><span class="line"></span><br><span class="line">let value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attribute">increment</span>: <span class="function"><span class="params">()</span> =&gt;</span> value++,</span><br><span class="line">  <span class="attribute">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> value,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再require测试：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-singleton.js</span></span><br><span class="line"></span><br><span class="line">const counter1 = <span class="function"><span class="title">require</span><span class="params">(‘./counter.js’)</span></span></span><br><span class="line">const counter2 = <span class="function"><span class="title">require</span><span class="params">(‘./counter.js’)</span></span></span><br><span class="line"></span><br><span class="line">counter1.<span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line">counter1.<span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line">counter2.<span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(counter1.get()</span></span>) <span class="comment">// prints 3</span></span><br><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(counter2.get()</span></span>) <span class="comment">// also prints 3</span></span><br></pre></td></tr></table></figure>
<p>证明了require是单次引入，本质上跟单例一致。所以不用担心这个notificationCenter非全局单例的疑虑。至此，这个通知中心也差不多完成了。</p>
<h5 id="参考资料">参考资料</h5><blockquote>
<p><a href="http://imweb.io/topic/582293894067ce9726778be9" target="_blank" rel="external">http://imweb.io/topic/582293894067ce9726778be9</a><br><a href="https://github.com/binnng/broadcast.js/blob/master/broadcast.js" target="_blank" rel="external">https://github.com/binnng/broadcast.js/blob/master/broadcast.js</a><br><a href="https://medium.com/@lazlojuly/are-node-js-modules-singletons-764ae97519af" target="_blank" rel="external">https://medium.com/@lazlojuly/are-node-js-modules-singletons-764ae97519af</a></p>
</blockquote>

      

      

    </div>
  </div>
  
</article>



  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        <aside id="sidebar">
  <nav class="menus">
  	<ul>
  		<li><a href="/"><i class="icon icon-home"></i></a></li>
  		
			<li><a href="/archives"><i class="icon icon-fenlei"></i></a></li>
  		
  		
			<li><a href="/tags"><i class="icon icon-tag"></i></a></li>
  		
  		
  			<li><a href="https://github.com/litt1e-p" target="_blank"><i class="icon icon-github"></i></a></li>
  		
  	</ul>
  </nav>
  <a id="go-top" href="#"><i class="icon icon-up"></i></a>
</aside>

      </div>
      <footer id="footer">
  
	<div id="footer-info" class="inner">
	  &copy; 2020 litt1e-p 
	  - Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	  - Theme <a href="https://github.com/hejianxian/hexo-theme-jane/" target="_blank">Jane</a>
	</div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tag</a>
  
    <a href="https://github.com/litt1e-p" class="mobile-nav-link">Github</a>
  
</nav>
    
<script>
  var disqus_shortname = 'litt1ep';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>